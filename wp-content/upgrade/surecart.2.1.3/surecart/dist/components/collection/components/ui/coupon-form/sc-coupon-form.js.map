{"version":3,"file":"sc-coupon-form.js","sourceRoot":"","sources":["../../../../src/components/ui/coupon-form/sc-coupon-form.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAgB,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AACtF,OAAO,EAAE,EAAE,EAAE,MAAM,iBAAiB,CAAC;AACrC,OAAO,EAAE,KAAK,EAAE,MAAM,+BAA+B,CAAC;AAEtD,OAAO,EAAE,gBAAgB,EAAE,MAAM,0BAA0B,CAAC;AAG5D;;;;;;;;;;;;;;;;;;;;GAoBG;AAMH,MAAM,OAAO,YAAY;;;;;;;;;;;;;;;;EA4CvB,wCAAwC;EAExC,gBAAgB,CAAC,GAAG;IAClB,IAAI,GAAG,EAAE;MACP,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE,EAAE,CAAC,CAAC;KACjD;EACH,CAAC;EAED,0CAA0C;EAC1C,UAAU;IACR,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;MACf,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;MAClB,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;KACjB;EACH,CAAC;EAED,wBAAwB;EACxB,WAAW;IACT,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;EAC1D,CAAC;EAED,aAAa,CAAC,CAAC;IACb,IAAI,CAAA,CAAC,aAAD,CAAC,uBAAD,CAAC,CAAE,IAAI,MAAK,OAAO,EAAE;MACvB,IAAI,CAAC,WAAW,EAAE,CAAC;KACpB;EACH,CAAC;EAED,MAAM;;IACJ,IAAI,IAAI,CAAC,OAAO,EAAE;MAChB,OAAO,mBAAa,KAAK,EAAE,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,cAAc,EAAE,GAAgB,CAAC;KACxF;IAED,IAAI,MAAA,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,SAAS,0CAAE,IAAI,EAAE;MACnC,IAAI,aAAa,GAAG,EAAE,CAAC;MAEvB,IAAI,CAAA,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,MAAM,MAAI,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,MAAM,CAAC,WAAW,CAAA,EAAE;QAChE,aAAa,GAAG,gBAAgB,CAAC,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,MAAM,CAAC,CAAC;OAC1D;MAED,OAAO,CACL,oBAAc,WAAW,EAAC,4DAA4D;QACpF,YAAM,IAAI,EAAC,aAAa;UACtB,WAAK,IAAI,EAAC,gBAAgB,IAAE,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC,CAAO;UAC7D,cACE,WAAW,EAAC,iBAAiB,EAC7B,IAAI,EAAC,SAAS,EACd,KAAK,EAAC,YAAY,EAClB,SAAS,QACT,SAAS,EAAE,GAAG,EAAE;cACd,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;cAC9B,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;YACpB,CAAC,IAEA,MAAA,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,SAAS,0CAAE,IAAI,CACzB,CACJ;QAEN,aAAa,IAAI,CAChB,YAAM,KAAK,EAAC,uBAAuB,EAAC,IAAI,EAAC,mBAAmB;;UACxD,aAAa;cACV,CACR;QAED,YAAM,IAAI,EAAC,OAAO;UAChB,wBAAkB,IAAI,EAAC,UAAU,EAAC,QAAQ,EAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,cAAc,GAAqB,CACvG,CACM,CAChB,CAAC;KACH;IAED,OAAO,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CACtB,WACE,IAAI,EAAC,MAAM,EACX,KAAK,EAAE;QACL,aAAa,EAAE,IAAI;QACnB,sBAAsB,EAAE,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS;QACnD,wBAAwB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK;QACtC,qBAAqB,EAAE,KAAK,EAAE;OAC/B;MAED,WACE,IAAI,EAAC,OAAO,EACZ,KAAK,EAAC,SAAS,EACf,WAAW,EAAE,GAAG,EAAE;UAChB,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,OAAO;WACR;UACD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACnB,CAAC;QAED,YAAM,IAAI,EAAC,OAAO,IAAE,IAAI,CAAC,KAAK,CAAQ,CAClC;MAEN,WAAK,KAAK,EAAC,MAAM,EAAC,IAAI,EAAC,MAAM;QAC3B,gBACE,WAAW,EAAC,2DAA2D,EACvE,KAAK,EAAE,IAAI,CAAC,KAAK,EACjB,SAAS,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EACpD,WAAW,EAAE,IAAI,CAAC,WAAW,EAC7B,QAAQ,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,EACjC,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,EACrC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,EAAwB,CAAC;UAElD,iBACE,WAAW,EAAC,uCAAuC,EACnD,IAAI,EAAC,QAAQ,EACb,IAAI,EAAC,MAAM,EACX,OAAO,EAAE,IAAI,CAAC,IAAI,EAClB,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,eAAe,EACrB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;YAEjC,gBAAO,IAAI,CAAC,UAAU,CAAQ,CACpB,CACH;QACX,iBACE,WAAW,EAAC,uCAAuC,EACnD,IAAI,EAAC,SAAS,EACd,OAAO,QACP,OAAO,EAAE,IAAI,CAAC,IAAI,EAClB,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,sBAAsB,EAC5B,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;UAEjC,gBAAO,IAAI,CAAC,UAAU,CAAQ,CACpB;QACX,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,CACf,gBAAU,WAAW,EAAC,iGAAiG,EAAC,IAAI,EAAC,QAAQ,EAAC,IAAI;UACxI,YAAM,IAAI,EAAC,OAAO,IAAE,IAAI,CAAC,KAAK,CAAQ,CAC7B,CACZ,CACG;MAEL,IAAI,CAAC,OAAO,IAAI,mBAAa,WAAW,EAAC,0CAA0C,GAAe,CAC/F,CACP,CAAC,CAAC,CAAC,CACF,WACE,KAAK,EAAE;QACL,aAAa,EAAE,IAAI;QACnB,wBAAwB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK;QACtC,qBAAqB,EAAE,KAAK,EAAE;OAC/B;MAED,gBACE,KAAK,EAAE,IAAI,CAAC,KAAK,EACjB,WAAW,EAAC,2DAA2D,EACvE,KAAK,EAAE,IAAI,CAAC,KAAK,EACjB,SAAS,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EACpD,WAAW,EAAE,IAAI,CAAC,WAAW,EAC7B,QAAQ,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,EACjC,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,EACrC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,EAAwB,CAAC;QAElD,iBACE,WAAW,EAAC,uCAAuC,EACnD,IAAI,EAAC,QAAQ,EACb,IAAI,EAAC,MAAM,EACX,OAAO,EAAE,IAAI,CAAC,IAAI,EAClB,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,eAAe,EACrB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;UAEjC,gBAAO,IAAI,CAAC,UAAU,CAAQ,CACpB,CACH;MACX,iBACE,WAAW,EAAC,uCAAuC,EACnD,IAAI,EAAC,SAAS,EACd,OAAO,QACP,OAAO,EAAE,IAAI,CAAC,IAAI,EAClB,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,sBAAsB,EAC5B,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;QAEjC,gBAAO,IAAI,CAAC,UAAU,CAAQ,CACpB;MACX,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,CACf,gBAAU,WAAW,EAAC,iGAAiG,EAAC,IAAI,EAAC,QAAQ,EAAC,IAAI;QACxI,YAAM,IAAI,EAAC,OAAO,IAAE,IAAI,CAAC,KAAK,CAAQ,CAC7B,CACZ,CACG,CACP,CAAC;EACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, Event, EventEmitter, h, Prop, State, Watch } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { isRtl } from '../../../functions/page-align';\n\nimport { getHumanDiscount } from '../../../functions/price';\nimport { DiscountResponse } from '../../../types';\n\n/**\n * @part base - The elements base wrapper.\n * @part form - The form.\n * @part input__base - The input base.\n * @part input - The input.\n * @part input__form-control - The input form control.\n * @part button__base - The button base element.\n * @part button__label - The button label.\n * @part info - The discount info.\n * @part discount - The discount displayed (% off)\n * @part amount - The discount amount.\n * @part discount-label - The discount label.\n * @part coupon-tag - The coupon tag.\n * @part error__base - The error base.\n * @part error__icon - The error icon\n * @part error__text - The error text.\n * @part error_title - The error title.\n * @part error__message - The error message.\n * @part block-ui - The block ui base component.\n * @part block-ui__content - The block ui content (spinner).\n */\n@Component({\n  tag: 'sc-coupon-form',\n  styleUrl: 'sc-coupon-form.scss',\n  shadow: true,\n})\nexport class ScCouponForm {\n  private input: HTMLScInputElement;\n\n  /** The label for the coupon form */\n  @Prop() label: string;\n\n  /** Is the form loading */\n  @Prop() loading: boolean;\n\n  /** Is the form calculating */\n  @Prop() busy: boolean;\n\n  /** The placeholder for the input */\n  @Prop() placeholder: string;\n\n  /** The error message */\n  @Prop({ mutable: true }) error: string;\n\n  /** Force the form to show */\n  @Prop() forceOpen: boolean;\n\n  /** The discount */\n  @Prop() discount: DiscountResponse;\n\n  /** Currency */\n  @Prop() currency: string;\n\n  /** The discount amount */\n  @Prop() discountAmount: number;\n\n  /** Is it open */\n  @Prop({ mutable: true }) open: boolean;\n\n  @Prop() collapsed: boolean;\n\n  /** The value of the input */\n  @State() value: string;\n\n  /** When the coupon is applied */\n  @Event() scApplyCoupon: EventEmitter<string>;\n\n  /** The text for apply button */\n  @Prop({ reflect: true }) buttonText: string;\n\n  /** Auto focus the input when opened. */\n  @Watch('open')\n  handleOpenChange(val) {\n    if (val) {\n      setTimeout(() => this.input.triggerFocus(), 50);\n    }\n  }\n\n  /** Close it when blurred and no value. */\n  handleBlur() {\n    if (!this.value) {\n      this.open = false;\n      this.error = '';\n    }\n  }\n\n  /** Apply the coupon. */\n  applyCoupon() {\n    this.scApplyCoupon.emit(this.input.value.toUpperCase());\n  }\n\n  handleKeyDown(e) {\n    if (e?.code === 'Enter') {\n      this.applyCoupon();\n    }\n  }\n\n  render() {\n    if (this.loading) {\n      return <sc-skeleton style={{ width: '120px', display: 'inline-block' }}></sc-skeleton>;\n    }\n\n    if (this?.discount?.promotion?.code) {\n      let humanDiscount = '';\n\n      if (this?.discount?.coupon && this?.discount?.coupon.percent_off) {\n        humanDiscount = getHumanDiscount(this?.discount?.coupon);\n      }\n\n      return (\n        <sc-line-item exportparts=\"description:info, price-description:discount, price:amount\">\n          <span slot=\"description\">\n            <div part=\"discount-label\">{__('Discount', 'surecart')}</div>\n            <sc-tag\n              exportparts=\"base:coupon-tag\"\n              type=\"success\"\n              class=\"coupon-tag\"\n              clearable\n              onScClear={() => {\n                this.scApplyCoupon.emit(null);\n                this.open = false;\n              }}\n            >\n              {this?.discount?.promotion?.code}\n            </sc-tag>\n          </span>\n\n          {humanDiscount && (\n            <span class=\"coupon-human-discount\" slot=\"price-description\">\n              ({humanDiscount})\n            </span>\n          )}\n\n          <span slot=\"price\">\n            <sc-format-number type=\"currency\" currency={this?.currency} value={this?.discountAmount}></sc-format-number>\n          </span>\n        </sc-line-item>\n      );\n    }\n\n    return this.collapsed ? (\n      <div\n        part=\"base\"\n        class={{\n          'coupon-form': true,\n          'coupon-form--is-open': this.open || this.forceOpen,\n          'coupon-form--has-value': !!this.value,\n          'coupon-form--is-rtl': isRtl(),\n        }}\n      >\n        <div\n          part=\"label\"\n          class=\"trigger\"\n          onMouseDown={() => {\n            if (this.open) {\n              return;\n            }\n            this.open = true;\n          }}\n        >\n          <slot name=\"label\">{this.label}</slot>\n        </div>\n\n        <div class=\"form\" part=\"form\">\n          <sc-input\n            exportparts=\"base:input__base, input, form-control:input__form-control\"\n            value={this.value}\n            onScInput={(e: any) => (this.value = e.target.value)}\n            placeholder={this.placeholder}\n            onScBlur={() => this.handleBlur()}\n            onKeyDown={e => this.handleKeyDown(e)}\n            ref={el => (this.input = el as HTMLScInputElement)}\n          >\n            <sc-button\n              exportparts=\"base:button__base, label:button_label\"\n              slot=\"suffix\"\n              type=\"text\"\n              loading={this.busy}\n              size=\"medium\"\n              class=\"coupon-button\"\n              onClick={() => this.applyCoupon()}\n            >\n              <slot>{this.buttonText}</slot>\n            </sc-button>\n          </sc-input>\n          <sc-button\n            exportparts=\"base:button__base, label:button_label\"\n            type=\"primary\"\n            outline\n            loading={this.busy}\n            size=\"medium\"\n            class=\"coupon-button-mobile\"\n            onClick={() => this.applyCoupon()}\n          >\n            <slot>{this.buttonText}</slot>\n          </sc-button>\n          {!!this.error && (\n            <sc-alert exportparts=\"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message\" type=\"danger\" open>\n              <span slot=\"title\">{this.error}</span>\n            </sc-alert>\n          )}\n        </div>\n\n        {this.loading && <sc-block-ui exportparts=\"base:block-ui, content:block-ui__content\"></sc-block-ui>}\n      </div>\n    ) : (\n      <div\n        class={{\n          'coupon-form': true,\n          'coupon-form--has-value': !!this.value,\n          'coupon-form--is-rtl': isRtl(),\n        }}\n      >\n        <sc-input\n          label={this.label}\n          exportparts=\"base:input__base, input, form-control:input__form-control\"\n          value={this.value}\n          onScInput={(e: any) => (this.value = e.target.value)}\n          placeholder={this.placeholder}\n          onScBlur={() => this.handleBlur()}\n          onKeyDown={e => this.handleKeyDown(e)}\n          ref={el => (this.input = el as HTMLScInputElement)}\n        >\n          <sc-button\n            exportparts=\"base:button__base, label:button_label\"\n            slot=\"suffix\"\n            type=\"text\"\n            loading={this.busy}\n            size=\"medium\"\n            class=\"coupon-button\"\n            onClick={() => this.applyCoupon()}\n          >\n            <slot>{this.buttonText}</slot>\n          </sc-button>\n        </sc-input>\n        <sc-button\n          exportparts=\"base:button__base, label:button_label\"\n          type=\"primary\"\n          outline\n          loading={this.busy}\n          size=\"medium\"\n          class=\"coupon-button-mobile\"\n          onClick={() => this.applyCoupon()}\n        >\n          <slot>{this.buttonText}</slot>\n        </sc-button>\n        {!!this.error && (\n          <sc-alert exportparts=\"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message\" type=\"danger\" open>\n            <span slot=\"title\">{this.error}</span>\n          </sc-alert>\n        )}\n      </div>\n    );\n  }\n}\n"]}