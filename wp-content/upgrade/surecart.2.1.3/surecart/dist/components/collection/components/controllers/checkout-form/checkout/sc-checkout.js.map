{"version":3,"file":"sc-checkout.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/checkout/sc-checkout.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, h, Listen, Method, Prop, State } from '@stencil/core';\nimport { state as checkoutState } from '@store/checkout';\nimport { state as processorsState } from '@store/processors';\nimport { state as formState } from '@store/form';\nimport { state as userState } from '@store/user';\nimport { __ } from '@wordpress/i18n';\nimport { Creator, Universe } from 'stencil-wormhole';\n\nimport {\n  Bump,\n  Checkout,\n  Customer,\n  FormState,\n  ManualPaymentMethod,\n  PaymentIntents,\n  PriceChoice,\n  Prices,\n  Processor,\n  ProcessorName,\n  Product,\n  Products,\n  ResponseError,\n  TaxProtocol,\n} from '../../../../types';\n\n@Component({\n  tag: 'sc-checkout',\n  styleUrl: 'sc-checkout.scss',\n  shadow: false,\n})\nexport class ScCheckout {\n  /** Element */\n  @Element() el: HTMLElement;\n\n  /** Holds the session provider reference. */\n  private sessionProvider: HTMLScSessionProviderElement;\n\n  /** An array of prices to pre-fill in the form. */\n  @Prop() prices: Array<PriceChoice> = [];\n\n  /** A product to pre-fill the form. */\n  @Prop() product: Product;\n\n  /** Are we in test or live mode. */\n  @Prop() mode: 'test' | 'live' = 'live';\n\n  /** The checkout form id */\n  @Prop() formId: number;\n\n  /** When the form was modified. */\n  @Prop() modified: string;\n\n  /** Currency to use for this checkout. */\n  @Prop() currencyCode: string = 'usd';\n\n  /** Whether to persist the session in the browser between visits. */\n  @Prop() persistSession: boolean = true;\n\n  /** Where to go on success */\n  @Prop() successUrl: string = '';\n\n  /** Stores the current customer */\n  @Prop({ mutable: true }) customer: Customer;\n\n  /** Alignment */\n  @Prop() alignment: 'center' | 'wide' | 'full';\n\n  /** The account tax protocol */\n  @Prop() taxProtocol: TaxProtocol;\n\n  /** Is this user logged in? */\n  @Prop({ mutable: true }) loggedIn: boolean;\n\n  /** Should we disable components validation */\n  @Prop() disableComponentsValidation: boolean;\n\n  /** Processors enabled for this form. */\n  @Prop({ mutable: true }) processors: Processor[];\n\n  /** Manual payment methods enabled for this form. */\n  @Prop() manualPaymentMethods: ManualPaymentMethod[];\n\n  /** Can we edit line items? */\n  @Prop() editLineItems: boolean = true;\n\n  /** Can we remove line items? */\n  @Prop() removeLineItems: boolean = true;\n\n  /** The abandoned checkout return url. */\n  @Prop() abandonedCheckoutReturnUrl: string;\n\n  /** Use the Stripe payment element. */\n  @Prop() stripePaymentElement: boolean = false;\n\n  /** Text for the loading states of the form. */\n  @Prop() loadingText: {\n    finalizing: string;\n    paying: string;\n    confirming: string;\n    confirmed: string;\n  };\n\n  /** Success text for the form. */\n  @Prop() successText: {\n    title: string;\n    description: string;\n    button: string;\n  };\n\n  /** Stores fetched prices for use throughout component.  */\n  @State() pricesEntities: Prices = {};\n\n  /** Stores fetched products for use throughout component.  */\n  @State() productsEntities: Products = {};\n\n  /** Loading states for different parts of the form. */\n  @State() checkoutState: FormState = 'idle';\n\n  /** Error to display. */\n  @State() error: ResponseError | null;\n\n  /** The currenly selected processor */\n  @State() processor: ProcessorName = 'stripe';\n\n  /** The processor method. */\n  @State() method: string;\n\n  /** Is the processor manual? */\n  @State() isManualProcessor: boolean;\n\n  /** Holds the payment intents for the checkout. */\n  @State() paymentIntents: PaymentIntents = {};\n\n  /** Is this form a duplicate form? (There's another on the page) */\n  @State() isDuplicate: boolean;\n\n  /** Checkout has been updated. */\n  @Event() scOrderUpdated: EventEmitter<Checkout>;\n\n  /** Checkout has been finalized. */\n  @Event() scOrderFinalized: EventEmitter<Checkout>;\n\n  /** Checkout has an error. */\n  @Event() scOrderError: EventEmitter<ResponseError>;\n\n  @Listen('scUpdateOrderState')\n  handleOrderStateUpdate(e: { detail: Checkout }) {\n    checkoutState.checkout = e.detail;\n  }\n\n  @Listen('scSetMethod')\n  handleMethodChange(e) {\n    this.method = e.detail;\n  }\n\n  @Listen('scAddEntities')\n  handleAddEntities(e) {\n    const { products, prices } = e.detail;\n    // add products.\n    if (Object.keys(products?.length || {})) {\n      this.productsEntities = {\n        ...this.productsEntities,\n        ...products,\n      };\n    }\n\n    // add prices.\n    if (Object.keys(prices?.length || {})) {\n      this.pricesEntities = {\n        ...this.pricesEntities,\n        ...prices,\n      };\n    }\n  }\n\n  /**\n   * Submit the form\n   */\n  @Method()\n  async submit({ skip_validation } = { skip_validation: false }) {\n    if (!skip_validation) {\n      await this.validate();\n    }\n    return await this.sessionProvider.finalize();\n  }\n\n  /**\n   * Validate the form.\n   */\n  @Method()\n  async validate() {\n    const form = this.el.querySelector('sc-form') as HTMLScFormElement;\n    return await form.validate();\n  }\n\n  componentWillLoad() {\n    const checkout = document.querySelector('sc-checkout');\n    this.isDuplicate = !!checkout && checkout !== this.el;\n    if (this.isDuplicate) return;\n\n    Universe.create(this as Creator, this.state());\n    processorsState.processors = this.processors;\n    processorsState.manualPaymentMethods = this.manualPaymentMethods;\n    processorsState.config.stripe.paymentElement = this.stripePaymentElement;\n    checkoutState.formId = this.formId;\n    checkoutState.mode = this.mode;\n    checkoutState.product = this.product || null;\n    checkoutState.currencyCode = this.currencyCode;\n    checkoutState.groupId = this.el.id;\n    checkoutState.abandonedCheckoutReturnUrl = this.abandonedCheckoutReturnUrl;\n    userState.loggedIn = this.loggedIn;\n    userState.email = this.customer?.email;\n    userState.name = this.customer?.name;\n  }\n\n  state() {\n    return {\n      processor: this.processor,\n      method: this.method,\n      selectedProcessorId: this.processor,\n      manualPaymentMethods: this.manualPaymentMethods,\n      processor_data: checkoutState.checkout?.processor_data,\n      state: this.checkoutState,\n      formState: formState.formState.value,\n      paymentIntents: this.paymentIntents,\n      successUrl: this.successUrl,\n      bumps: checkoutState.checkout?.recommended_bumps?.data as Bump[],\n\n      order: checkoutState.checkout,\n      abandonedCheckoutEnabled: checkoutState.checkout?.abandoned_checkout_enabled,\n      checkout: checkoutState.checkout,\n      shippingEnabled: checkoutState.checkout?.shipping_enabled,\n      lineItems: checkoutState.checkout?.line_items?.data || [],\n      editLineItems: this.editLineItems,\n      removeLineItems: this.removeLineItems,\n\n      // checkout states\n      loading: formState.formState.value === 'loading',\n      busy: ['updating', 'finalizing', 'paying', 'confirming'].includes(formState.formState.value),\n      paying: ['finalizing', 'paying', 'confirming'].includes(formState.formState.value),\n      empty: !['loading', 'updating'].includes(formState.formState.value) && !checkoutState.checkout?.line_items?.pagination?.count,\n      // checkout states\n\n      // stripe.\n      stripePaymentElement: this.stripePaymentElement,\n      stripePaymentIntent: (checkoutState.checkout?.staged_payment_intents?.data || []).find(intent => intent.processor_type === 'stripe'),\n\n      error: this.error,\n      customer: this.customer,\n      tax_status: checkoutState.checkout?.tax_status,\n      taxEnabled: checkoutState.checkout?.tax_enabled,\n      customerShippingAddress: typeof checkoutState.checkout?.customer !== 'string' ? checkoutState.checkout?.customer?.shipping_address : {},\n      shippingAddress: checkoutState.checkout?.shipping_address,\n      taxStatus: checkoutState.checkout?.tax_status,\n      taxIdentifier: checkoutState.checkout?.tax_identifier,\n      totalAmount: checkoutState.checkout?.total_amount,\n      taxProtocol: this.taxProtocol,\n      lockedChoices: this.prices,\n      products: this.productsEntities,\n      prices: this.pricesEntities,\n      country: 'US',\n      loggedIn: this.loggedIn,\n      emailExists: checkoutState.checkout?.email_exists,\n      formId: this.formId,\n      mode: this.mode,\n      currencyCode: this.currencyCode,\n    };\n  }\n\n  render() {\n    if (this.isDuplicate) {\n      return <sc-alert open>{__('Due to processor restrictions, only one checkout form is allowed on the page.', 'surecart')}</sc-alert>;\n    }\n\n    return (\n      <div\n        class={{\n          'sc-checkout-container': true,\n          'sc-align-center': this.alignment === 'center',\n          'sc-align-wide': this.alignment === 'wide',\n          'sc-align-full': this.alignment === 'full',\n        }}\n      >\n        {/* Handles unsaved changes warning depending on checkout state */}\n        <sc-checkout-unsaved-changes-warning state={this.checkoutState} />\n        {/* Univers provider */}\n        <Universe.Provider state={this.state()}>\n          {/** Handles login form prompts. */}\n          <sc-login-provider\n            loggedIn={this.loggedIn}\n            onScSetCustomer={e => (this.customer = e.detail as Customer)}\n            onScSetLoggedIn={e => (this.loggedIn = e.detail)}\n            order={checkoutState.checkout}\n          >\n            {/* Handles the current checkout form state. */}\n            <sc-form-state-provider onScSetCheckoutFormState={e => (this.checkoutState = e.detail)}>\n              {/* Handles errors in the form. */}\n              <sc-form-error-provider checkoutState={formState.formState.value} onScUpdateError={e => (this.error = e.detail)}>\n                {/* Validate components in the form based on order state. */}\n                <sc-form-components-validator order={checkoutState.checkout} disabled={this.disableComponentsValidation} taxProtocol={this.taxProtocol}>\n                  {/* Handle confirming of order after it is \"Paid\" by processors. */}\n                  <sc-order-confirm-provider success-url={this.successUrl} successText={this.successText}>\n                    {/* Handles the current session. */}\n                    <sc-session-provider\n                      ref={el => (this.sessionProvider = el as HTMLScSessionProviderElement)}\n                      prices={this.prices}\n                      persist={this.persistSession}\n                      onScError={e => (this.error = e.detail as ResponseError)}\n                    >\n                      <slot />\n                    </sc-session-provider>\n                  </sc-order-confirm-provider>\n                </sc-form-components-validator>\n              </sc-form-error-provider>\n            </sc-form-state-provider>\n          </sc-login-provider>\n\n          {this.state().busy && <sc-block-ui class=\"busy-block-ui\" z-index={30}></sc-block-ui>}\n\n          {formState.formState.value === 'finalizing' && (\n            <sc-block-ui z-index={30} spinner style={{ '--sc-block-ui-opacity': '0.75' }}>\n              {this.loadingText?.finalizing || __('Submitting order...', 'surecart')}\n            </sc-block-ui>\n          )}\n\n          {formState.formState.value === 'paying' && (\n            <sc-block-ui z-index={30} spinner style={{ '--sc-block-ui-opacity': '0.75' }}>\n              {this.loadingText?.paying || __('Processing payment...', 'surecart')}\n            </sc-block-ui>\n          )}\n\n          {formState.formState.value === 'confirming' && (\n            <sc-block-ui z-index={30} spinner style={{ '--sc-block-ui-opacity': '0.75' }}>\n              {this.loadingText?.confirming || __('Finalizing order...', 'surecart')}\n            </sc-block-ui>\n          )}\n\n          {formState.formState.value === 'redirecting' && (\n            <sc-block-ui z-index={30} spinner style={{ '--sc-block-ui-opacity': '0.75' }}>\n              {this.loadingText?.confirmed || __('Success! Redirecting...', 'surecart')}\n            </sc-block-ui>\n          )}\n        </Universe.Provider>\n      </div>\n    );\n  }\n}\n"]}