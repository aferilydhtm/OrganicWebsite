{"version":3,"file":"sc-form-components-validator.js","sourceRoot":"","sources":["../../../../src/components/providers/form-components-validator/sc-form-components-validator.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AAC1E,OAAO,EAAE,EAAE,EAAE,MAAM,iBAAiB,CAAC;AAQrC,MAAM,OAAO,yBAAyB;;;;;;;;;;;EA4BpC,iBAAiB;;IACf,2DAA2D;IAC3D,IAAI,IAAI,CAAC,QAAQ;MAAE,OAAO;IAC1B,wDAAwD;IACxD,IAAI,CAAA,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,0CAAE,UAAU,MAAK,iBAAiB,KAAI,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,0CAAE,gBAAgB,CAAA,EAAE;MAClF,IAAI,CAAC,eAAe,EAAE,CAAC;KACxB;IACD,mBAAmB;IACnB,IAAI,MAAA,MAAA,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,0CAAE,iBAAiB,0CAAE,IAAI,0CAAE,MAAM,EAAE;MAChD,IAAI,CAAC,QAAQ,EAAE,CAAC;KACjB;IACD,IAAI,CAAC,CAAC,CAAA,MAAA,IAAI,CAAC,KAAK,0CAAE,UAAU,CAAA,EAAE;MAC5B,IAAI,CAAC,UAAU,EAAE,CAAC;KACnB;EACH,CAAC;EAED,iBAAiB;;IACf,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;IACvE,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;IACtE,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;IAC/D,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;IAE9D,qDAAqD;IACrD,IAAI,MAAA,IAAI,CAAC,WAAW,0CAAE,WAAW,EAAE;MACjC,IAAI,CAAC,eAAe,EAAE,CAAC;MAEvB,+CAA+C;MAC/C,IAAI,MAAA,IAAI,CAAC,WAAW,0CAAE,eAAe,EAAE;QACrC,IAAI,CAAC,aAAa,EAAE,CAAC;OACtB;KACF;IAED,oCAAoC;IACpC,IAAI,CAAC,iBAAiB,EAAE,CAAC;EAC3B,CAAC;EAED,eAAe;IACb,IAAI,IAAI,CAAC,UAAU;MAAE,OAAO;IAC5B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACpD,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;IACpE,OAAO,CAAC,KAAK,GAAG,EAAE,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;IAC1C,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAClD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;EACzB,CAAC;EAED,aAAa;;IACX,IAAI,IAAI,CAAC,aAAa;MAAE,OAAO;IAC/B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACpD,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;IACjE,CAAA,MAAA,QAAQ,CAAC,aAAa,0CAAE,WAAW,MAAK,QAAQ,CAAC;IACjD,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IACnD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;EAC5B,CAAC;EAED,QAAQ;;IACN,IAAI,IAAI,CAAC,aAAa;MAAE,OAAO;IAC/B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACpD,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;IACvD,KAAK,CAAC,KAAK,MAAK,MAAA,MAAA,IAAI,CAAC,KAAK,0CAAE,iBAAiB,0CAAE,IAAI,CAAA,CAAC;IACpD,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;IAC5D,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;EAC5B,CAAC;EAED,UAAU;;IACR,IAAI,IAAI,CAAC,UAAU;MAAE,OAAO;IAC5B,MAAM,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,iCAAiC,CAAC,CAAC;IACvE,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;IACvD,IAAI,CAAA,MAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,sBAAsB,0CAAE,OAAO,MAAK,YAAY,EAAE;MAC3D,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,sBAAsB,CAAC,CAAC;KAClE;SAAM;MACL,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;KAC3C;IACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;EACzB,CAAC;EAED,MAAM;IACJ,OAAO,eAAQ,CAAC;EAClB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, Element, h, Prop, State, Watch } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\n\nimport { Checkout, TaxProtocol } from '../../../types';\n\n@Component({\n  tag: 'sc-form-components-validator',\n  shadow: true,\n})\nexport class ScFormComponentsValidator {\n  @Element() el: HTMLScFormComponentsValidatorElement;\n\n  /** Disable validation? */\n  @Prop() disabled: boolean;\n\n  /** The order */\n  @Prop() order: Checkout;\n\n  /** The tax protocol */\n  @Prop() taxProtocol: TaxProtocol;\n\n  /** Is there an address field? */\n  @State() hasAddress: boolean;\n\n  /** Is there a tax id field? */\n  @State() hasTaxIDField: boolean;\n\n  /** Is there a bumps field? */\n  @State() hasBumpsField: boolean;\n\n  /** Is there a tax line? */\n  @State() hasTaxLine: boolean;\n\n  /** Is there a bump line? */\n  @State() hasBumpLine: boolean;\n\n  @Watch('order')\n  handleOrderChange() {\n    // bail if we don't have address invalid error or disabled.\n    if (this.disabled) return;\n    // make sure to add the address field if it's not there.\n    if (this?.order?.tax_status === 'address_invalid' || this?.order?.shipping_enabled) {\n      this.addAddressField();\n    }\n    // add order bumps.\n    if (this?.order?.recommended_bumps?.data?.length) {\n      this.addBumps();\n    }\n    if (!!this.order?.tax_amount) {\n      this.addTaxLine();\n    }\n  }\n\n  componentWillLoad() {\n    this.hasAddress = !!this.el.querySelector('sc-order-shipping-address');\n    this.hasTaxIDField = !!this.el.querySelector('sc-order-tax-id-input');\n    this.hasBumpsField = !!this.el.querySelector('sc-order-bumps');\n    this.hasTaxLine = !!this.el.querySelector('sc-line-item-tax');\n\n    // automatically add address field if tax is enabled.\n    if (this.taxProtocol?.tax_enabled) {\n      this.addAddressField();\n\n      // if eu vat is required, add the tax id field.\n      if (this.taxProtocol?.eu_vat_required) {\n        this.addTaxIDField();\n      }\n    }\n\n    // make sure to check order on load.\n    this.handleOrderChange();\n  }\n\n  addAddressField() {\n    if (this.hasAddress) return;\n    const payment = this.el.querySelector('sc-payment');\n    const address = document.createElement('sc-order-shipping-address');\n    address.label = __('Address', 'surecart');\n    payment.parentNode.insertBefore(address, payment);\n    this.hasAddress = true;\n  }\n\n  addTaxIDField() {\n    if (this.hasTaxIDField) return;\n    const payment = this.el.querySelector('sc-payment');\n    const taxInput = document.createElement('sc-order-tax-id-input');\n    taxInput.taxIdentifier?.number_type === 'eu_vat';\n    payment.parentNode.insertBefore(taxInput, payment);\n    this.hasTaxIDField = true;\n  }\n\n  addBumps() {\n    if (this.hasBumpsField) return;\n    const payment = this.el.querySelector('sc-payment');\n    const bumps = document.createElement('sc-order-bumps');\n    bumps.bumps === this.order?.recommended_bumps?.data;\n    payment.parentNode.insertBefore(bumps, payment.nextSibling);\n    this.hasBumpsField = true;\n  }\n\n  addTaxLine() {\n    if (this.hasTaxLine) return;\n    const total = this.el.querySelector('sc-line-item-total[total=total]');\n    const tax = document.createElement('sc-line-item-tax');\n    if (total?.previousElementSibling?.tagName === 'SC-DIVIDER') {\n      total.parentNode.insertBefore(tax, total.previousElementSibling);\n    } else {\n      total.parentNode.insertBefore(tax, total);\n    }\n    this.hasTaxLine = true;\n  }\n\n  render() {\n    return <slot />;\n  }\n}\n"]}