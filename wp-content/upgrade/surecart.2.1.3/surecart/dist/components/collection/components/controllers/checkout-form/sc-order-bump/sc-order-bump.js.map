{"version":3,"file":"sc-order-bump.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/sc-order-bump/sc-order-bump.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Prop } from '@stencil/core';\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { isBumpInOrder } from '../../../../functions/line-items';\nimport { intervalString } from '../../../../functions/price';\nimport { sizeImage } from '../../../../functions/media';\n\nimport { Bump, Checkout, LineItemData, Price, Product } from '../../../../types';\n\n@Component({\n  tag: 'sc-order-bump',\n  styleUrl: 'sc-order-bump.scss',\n  shadow: true,\n})\nexport class ScOrderBump {\n  /** The bump */\n  @Prop() bump: Bump;\n\n  /** The checkout */\n  @Prop() checkout: Checkout;\n\n  /** Should we show the controls */\n  @Prop({ reflect: true }) showControl: boolean;\n\n  @Prop() cdnRoot: string = window.scData?.cdn_root;\n\n  /** Add line item event */\n  @Event() scAddLineItem: EventEmitter<LineItemData>;\n\n  /** Remove line item event */\n  @Event() scRemoveLineItem: EventEmitter<LineItemData>;\n\n  /** Update the line item. */\n  updateLineItem(add: boolean) {\n    const price_id = (this.bump.price as Price)?.id || (this.bump?.price as string);\n    if (add) {\n      this.scAddLineItem.emit({\n        bump: this.bump?.id,\n        price_id,\n        quantity: 1,\n      });\n    } else {\n      this.scRemoveLineItem.emit({\n        price_id,\n        quantity: 1,\n      });\n    }\n  }\n\n  newPrice() {\n    let amount = null;\n    let initialAmount = (this.bump?.price as Price)?.amount || 0;\n\n    if (this.bump?.amount_off) {\n      amount = Math.max(0, initialAmount - this.bump?.amount_off);\n    }\n    if (this.bump?.percent_off) {\n      const off = initialAmount * (this.bump?.percent_off / 100);\n      amount = Math.max(0, initialAmount - off);\n    }\n\n    return amount;\n  }\n\n  renderInterval() {\n    const interval = intervalString(this.bump?.price as Price, { labels: { interval: '/', period: __('for', 'surecart') } });\n    if (!interval.trim().length) return null;\n    return <span class=\"bump__interval\">{interval}</span>;\n  }\n\n  renderPrice() {\n    return (\n      <div slot=\"description\" class={{ 'bump__price': true, 'bump__price--has-discount': !!this.bump?.percent_off || !!this.bump?.amount_off }} part=\"price\">\n        <sc-format-number\n          type=\"currency\"\n          class=\"bump__original-price\"\n          value={(this.bump?.price as Price)?.amount}\n          currency={(this.bump?.price as Price)?.currency}\n        ></sc-format-number>{' '}\n        {this.newPrice() === 0 && __('Free', 'surecart')}\n        {this.newPrice() !== null && this.newPrice() > 0 && (\n          <sc-format-number type=\"currency\" class=\"bump__new-price\" value={this.newPrice()} currency={(this.bump?.price as Price).currency} />\n        )}\n        {this.renderInterval()}\n      </div>\n    );\n  }\n\n  renderDiscount() {\n    if (!!this.bump?.amount_off) {\n      return (\n        <div class=\"bump__tag\">\n          {__('Save', 'surecart')} <sc-format-number type=\"currency\" value={-this.bump?.amount_off} currency={(this.bump?.price as Price).currency}></sc-format-number>\n        </div>\n      );\n    }\n\n    if (!!this.bump?.percent_off) {\n      return <div class=\"bump__tag\">{sprintf(__('Save %s%%', 'surecart'), this.bump?.percent_off)}</div>;\n    }\n  }\n\n  render() {\n    const product = (this.bump?.price as Price)?.product as Product;\n\n    return (\n      <sc-choice\n        value={this.bump?.id}\n        type=\"checkbox\"\n        showControl={this.showControl}\n        checked={isBumpInOrder(this.bump, this.checkout)}\n        onScChange={e => this.updateLineItem(e.target.checked)}\n        exportparts=\"base, control, checked-icon, title\"\n      >\n        <div part=\"base-content\" class=\"bump\">\n          <div class=\"bump__text\">\n            <div class=\"bump__title\">{this.bump?.metadata?.cta || this.bump?.name || product?.name}</div>\n            <div class=\"bump__amount\">\n              {this.renderPrice()} {this.renderDiscount()}\n            </div>\n          </div>\n        </div>\n\n        {this.bump?.metadata?.description && (\n          <div slot=\"footer\">\n            <sc-divider style={{ '--spacing': 'var(--sc-spacing-medium)' }}></sc-divider>\n            <div class=\"bump__product\">\n              {!!product?.image_url && <img src={sizeImage(product?.image_url, 130)} class=\"bump__image\" />}\n              <div class=\"bump__product-text\">\n                {!!this.bump?.metadata?.cta && <div class=\"bump__product-title\">{this.bump.name || product?.name}</div>}\n                {!!this.bump?.metadata?.description && <div class=\"bump__product-description\">{this.bump?.metadata?.description}</div>}\n              </div>\n            </div>\n          </div>\n        )}\n      </sc-choice>\n    );\n  }\n}\n"]}