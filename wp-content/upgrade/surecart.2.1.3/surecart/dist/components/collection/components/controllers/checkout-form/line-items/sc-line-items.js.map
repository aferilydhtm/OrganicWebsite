{"version":3,"file":"sc-line-items.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/line-items/sc-line-items.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Prop } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { openWormhole } from 'stencil-wormhole';\n\nimport { hasSubscription } from '../../../../functions/line-items';\nimport { intervalString } from '../../../../functions/price';\nimport { LineItem, LineItemData, Checkout, PriceChoice, Prices, Product } from '../../../../types';\n\n@Component({\n  tag: 'sc-line-items',\n  styleUrl: 'sc-line-items.css',\n  shadow: true,\n})\nexport class ScLineItems {\n  @Prop() order: Checkout;\n  @Prop() busy: boolean;\n  @Prop() prices: Prices;\n  @Prop() editable: boolean;\n  @Prop() removable: boolean;\n  @Prop() editLineItems: boolean = true;\n  @Prop() removeLineItems: boolean = true;\n  @Prop() lockedChoices: Array<PriceChoice> = [];\n\n  /** Update the line item. */\n  @Event() scUpdateLineItem: EventEmitter<LineItemData>;\n\n  /** Remove the line item. */\n  @Event() scRemoveLineItem: EventEmitter<LineItemData>;\n\n  /** Update quantity for this line item. */\n  updateQuantity(item: LineItem, quantity: number) {\n    this.scUpdateLineItem.emit({ price_id: item.price.id, quantity });\n  }\n\n  removeLineItem(item: LineItem) {\n    this.scRemoveLineItem.emit({ price_id: item.price.id, quantity: 1 });\n  }\n\n  /** Only append price name if there's more than one product price in the session. */\n  getName(item: LineItem) {\n    const otherPrices = Object.keys(this.prices || {}).filter(key => {\n      const price = this.prices[key];\n      // @ts-ignore\n      return price.product === item.price.product.id;\n    });\n\n    let name = '';\n    if (otherPrices.length > 1) {\n      name = `${(item?.price?.product as Product)?.name} \\u2013 ${item?.price?.name}`;\n    } else {\n      name = (item?.price?.product as Product)?.name;\n    }\n    return name;\n  }\n\n  // Is this price choice locked?\n  isLocked(item) {\n    return this.lockedChoices.some(choice => choice.id === item.price.id);\n  }\n\n  isEditable(item: LineItem) {\n    // ad hoc prices cannot have quantity.\n    if (item?.price?.ad_hoc) {\n      return false;\n    }\n\n    // if the item has a bump amount, it cannot have quantity.\n    if (item?.bump_amount) {\n      return false;\n    }\n\n    if (this.editable !== null) return this.editable;\n    return this.editLineItems;\n  }\n\n  isRemovable() {\n    if (this.removable !== null) return this.removable;\n    return this.removeLineItems;\n  }\n\n  render() {\n    if (!!this.busy && !this.order?.line_items?.data?.length) {\n      return (\n        <sc-line-item>\n          <sc-skeleton style={{ 'width': '50px', 'height': '50px', '--border-radius': '0' }} slot=\"image\"></sc-skeleton>\n          <sc-skeleton slot=\"title\" style={{ width: '120px', display: 'inline-block' }}></sc-skeleton>\n          <sc-skeleton slot=\"description\" style={{ width: '60px', display: 'inline-block' }}></sc-skeleton>\n          <sc-skeleton style={{ width: '120px', display: 'inline-block' }} slot=\"price\"></sc-skeleton>\n          <sc-skeleton style={{ width: '60px', display: 'inline-block' }} slot=\"price-description\"></sc-skeleton>\n        </sc-line-item>\n      );\n    }\n\n    return (\n      <div class=\"line-items\">\n        {(this.order?.line_items?.data || [])\n          .sort((a, b) => {\n            if (a.price?.id < b.price?.id) return -1;\n            return a.price?.id > b.price?.id ? 1 : 0;\n          })\n          .map(item => {\n            return (\n              <div class=\"line-item\">\n                <sc-product-line-item\n                  key={item.id}\n                  imageUrl={(item?.price?.product as Product)?.image_url}\n                  name={(item?.price?.product as Product)?.name}\n                  max={(item?.price?.product as Product)?.purchase_limit}\n                  editable={this.isEditable(item)}\n                  removable={this.isRemovable()}\n                  quantity={item.quantity}\n                  fees={item?.fees?.data}\n                  setupFeeTrialEnabled={item?.price?.setup_fee_trial_enabled}\n                  amount={item.ad_hoc_amount !== null ? item.ad_hoc_amount : item.subtotal_amount}\n                  scratchAmount={item.ad_hoc_amount == null && item?.scratch_amount}\n                  currency={this.order?.currency}\n                  trialDurationDays={item?.price?.trial_duration_days}\n                  interval={!!item?.price && intervalString(item?.price, { showOnce: hasSubscription(this.order) })}\n                  onScUpdateQuantity={e => this.updateQuantity(item, e.detail)}\n                  onScRemove={() => this.removeLineItem(item)}\n                />\n              </div>\n            );\n          })}\n      </div>\n    );\n  }\n}\n\nopenWormhole(ScLineItems, ['order', 'busy', 'prices', 'lockedChoices', 'editLineItems', 'removeLineItems'], false);\n"]}