import{proxyCustomElement,HTMLElement,createEvent,h}from"@stencil/core/internal/client";import{u as updateCheckout}from"./index3.js";import{d as defineCustomElement$1}from"./sc-line-items-provider2.js";const ScCartSessionProvider=proxyCustomElement(class extends HTMLElement{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.scUpdateOrderState=createEvent(this,"scUpdateOrderState",7),this.scError=createEvent(this,"scError",7),this.scSetState=createEvent(this,"scSetState",7),this.order=void 0,this.session=void 0}handleSessionUpdate(e){this.scUpdateOrderState.emit(e)}handleUpdateSession(e){const{data:t,options:s}=e.detail;(null==s?void 0:s.silent)?this.update(t):this.loadUpdate(t)}async handleCouponApply(e){const t=e.detail;this.scError.emit({}),this.loadUpdate({discount:{...t?{promotion_code:t}:{}}})}handleErrorResponse(e){var t,s;"readonly"!==(null==e?void 0:e.code)&&"checkout.customer.account_mismatch"!==(null===(s=null===(t=null==e?void 0:e.additional_errors)||void 0===t?void 0:t[0])||void 0===s?void 0:s.code)||this.scUpdateOrderState.emit(null),"rest_cookie_invalid_nonce"!==(null==e?void 0:e.code)?((null==e?void 0:e.message)&&this.scError.emit(e),"http_request_failed"===(null==e?void 0:e.code)&&this.scError.emit({message:"Something went wrong. Please reload the page and try again."}),this.scSetState.emit("idle")):this.scSetState.emit("idle")}async fetch(e={}){this.loadUpdate({status:"draft",...e})}async update(e={},t={}){var s;try{this.session=await updateCheckout({id:null===(s=this.order)||void 0===s?void 0:s.id,data:{...e},query:{...t}})}catch(e){throw console.error(e),e}}async loadUpdate(e={}){try{this.scSetState.emit("busy"),await this.update(e),this.scSetState.emit("idle")}catch(e){this.handleErrorResponse(e)}}render(){return h("sc-line-items-provider",{order:this.order,onScUpdateLineItems:e=>this.loadUpdate({line_items:e.detail})},h("slot",null))}get el(){return this}static get watchers(){return{session:["handleSessionUpdate"]}}},[1,"sc-cart-session-provider",{order:[16],session:[32]},[[0,"scUpdateOrder","handleUpdateSession"],[0,"scApplyCoupon","handleCouponApply"]]]);function defineCustomElement(){"undefined"!=typeof customElements&&["sc-cart-session-provider","sc-line-items-provider"].forEach((e=>{switch(e){case"sc-cart-session-provider":customElements.get(e)||customElements.define(e,ScCartSessionProvider);break;case"sc-line-items-provider":customElements.get(e)||defineCustomElement$1()}}))}export{ScCartSessionProvider as S,defineCustomElement as d};