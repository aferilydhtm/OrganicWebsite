{"file":"watchers2.js","mappings":"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","names":["checkoutState"],"sources":["../../node_modules/@wordpress/url/build-module/remove-query-args.js","./src/store/checkout/store.ts","./src/store/local/storage.ts","./src/store/checkouts.ts","./src/store/checkout/watchers.ts"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { getQueryArgs } from './get-query-args';\nimport { buildQueryString } from './build-query-string';\n/**\n * Removes arguments from the query string of the url\n *\n * @param {string}    url  URL.\n * @param {...string} args Query Args.\n *\n * @example\n * ```js\n * const newUrl = removeQueryArgs( 'https://wordpress.org?foo=bar&bar=baz&baz=foobar', 'foo', 'bar' ); // https://wordpress.org?baz=foobar\n * ```\n *\n * @return {string} Updated URL.\n */\n\nexport function removeQueryArgs(url) {\n  const queryStringIndex = url.indexOf('?');\n\n  if (queryStringIndex === -1) {\n    return url;\n  }\n\n  const query = getQueryArgs(url);\n  const baseURL = url.substr(0, queryStringIndex);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  args.forEach(arg => delete query[arg]);\n  const queryString = buildQueryString(query);\n  return queryString ? baseURL + '?' + queryString : baseURL;\n}\n//# sourceMappingURL=remove-query-args.js.map","import { createStore } from '@stencil/store';\n\nimport { Checkout, Product } from '../../types';\n\ninterface Store {\n  formId: number | string;\n  groupId: string;\n  mode: 'live' | 'test';\n  locks: string[];\n  product: Product;\n  checkout: Checkout;\n  currencyCode: string;\n  abandonedCheckoutReturnUrl: string;\n  abandonedCheckoutEnabled: boolean;\n}\n\nconst { state, onChange, on, set, get, dispose } = createStore<Store>(\n  {\n    formId: null,\n    groupId: null,\n    mode: 'live',\n    locks: [],\n    product: null,\n    checkout: null,\n    currencyCode: 'usd',\n    abandonedCheckoutReturnUrl: null,\n    abandonedCheckoutEnabled: true,\n  },\n  (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nexport default state;\nexport { state, onChange, on, set, get, dispose };\n","import { createStore } from '@stencil/store';\nimport { MinimumStorage } from './types';\n\nconst safeRead = <T extends object>(storage: MinimumStorage, key: string): T | null => {\n  try {\n    return JSON.parse(storage.getItem(key));\n  } catch {\n    return null;\n  }\n};\n\nconst debounce = fn => {\n  let called = false;\n  return () => {\n    if (called) {\n      return;\n    }\n    called = true;\n    setTimeout(() => {\n      fn();\n      called = false;\n    }, 0);\n  };\n};\n\nexport const createStorageStore = <T extends object>(storage: MinimumStorage, key: string, defaultValues: T, syncAcrossTabs = false) => {\n  const store = createStore(safeRead<T>(storage, key) ?? defaultValues, (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  });\n\n  // Need to sync later or we would get ourselves in an infinite loop.\n  const write = debounce(() => storage.setItem(key, JSON.stringify(store.state)));\n  write();\n\n  if (syncAcrossTabs) {\n    window.addEventListener('storage', () => {\n      const currentState = safeRead<T>(storage, key);\n\n      if (currentState === null) {\n        return;\n      }\n\n      for (const key in currentState) {\n        store.set(key, currentState[key]);\n      }\n    });\n  }\n\n  store.use({ set: write, reset: write });\n\n  return store;\n};\n\nexport const createLocalStore = <T extends object>(key: string, defaultValues: T, syncAcrossTabs = false) => createStorageStore(localStorage, key, defaultValues, syncAcrossTabs);\nexport const createSessionStore = <T extends object>(key: string, defaultValues: T) => createStorageStore(sessionStorage, key, defaultValues);\n","import { Checkout } from '../types';\nimport { createLocalStore } from './local';\nimport { createStore } from '@stencil/store';\nimport { state as checkoutState } from '@store/checkout';\nimport { addQueryArgs, removeQueryArgs } from '@wordpress/url';\n\nconst store = window?.scData?.do_not_persist_cart\n  ? createStore<{ live: any; test: any }>({\n      live: {},\n      test: {},\n    })\n  : createLocalStore<{ live: any; test: any }>(\n      'surecart-local-storage',\n      {\n        live: {},\n        test: {},\n      },\n      true,\n    );\n\nwindow.scStore = store;\nexport default store;\n\n/** Get the checkout. */\nexport const getOrder = (formId: number | string, mode: 'live' | 'test') => store.state[mode]?.[formId] || {};\nexport const getCheckout = getOrder;\n\n/** Set the checkout. */\nexport const setOrder = (data: Checkout, formId: number | string) => {\n  const mode = data?.live_mode ? 'live' : 'test';\n  store.set(mode, { ...store.state[mode], [formId]: data });\n  // update the current checkout state.\n  if (checkoutState.formId === formId && checkoutState.mode === mode) {\n    checkoutState.checkout = data;\n  }\n  // set in url only if we are not persisting the cart.\n  if (window?.scData?.do_not_persist_cart && data?.id) {\n    window.history.replaceState({}, document.title, addQueryArgs(window.location.href, { checkout_id: data?.id }));\n  }\n};\nexport const setCheckout = setOrder;\n\n/** Clear the order from the store. */\nexport const clearOrder = (formId: number | string, mode: 'live' | 'test') => {\n  const { [formId]: remove, ...checkouts } = store.state[mode];\n  window.history.replaceState({}, document.title, removeQueryArgs(window.location.href, 'redirect_status', 'coupon', 'line_items', 'confirm_checkout_id', 'checkout_id'));\n  return store.set(mode, checkouts);\n};\nexport const clearCheckout = clearOrder;\n","import state, { onChange, on } from './store';\nimport { getCheckout, setCheckout } from '../checkouts';\n\n/**\n * When the checkout changes, update the\n * checkout in localstorage.\n */\nonChange('checkout', val => setCheckout(val, state.formId));\n\non('get', prop => {\n  if (prop === 'checkout') {\n    const checkout = getCheckout(state.formId, state.mode);\n    if (checkout?.id) {\n      state.checkout = checkout;\n    }\n  }\n});\n"],"version":3}