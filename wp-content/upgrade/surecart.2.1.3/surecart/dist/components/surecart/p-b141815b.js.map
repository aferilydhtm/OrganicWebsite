{"version":3,"names":["product","_b","_a","window","scData","product_data","prices","_c","data","selectedPrice","sort","a","b","position","find","price","archived","adHocAmount","amount","store","createStore","formId","_f","_e","_d","form","ID","mode","_h","_g","quantity","total","dialog","busy","disabled","error","checkoutUrl","_k","_j","checkout_link","line_item","price_id","id","ad_hoc","ad_hoc_amount","newValue","oldValue","JSON","stringify","state","onChange","on","dispose","forceUpdate","_l","sc","value","setLineItem"],"sources":["./src/store/product/store.ts","./src/store/product/watchers.ts"],"sourcesContent":["import { createStore } from '@stencil/store';\nimport { LineItemData } from 'src/types';\nimport { Price, Product } from 'src/types';\n\ninterface Store {\n  formId: number;\n  mode: 'live' | 'test';\n  product: Product;\n  prices: Price[];\n  quantity: number;\n  selectedPrice: Price;\n  total: number;\n  busy: boolean;\n  disabled: boolean;\n  checkoutUrl: string;\n  adHocAmount: number;\n  dialog: string;\n  line_item: LineItemData;\n  error: string;\n}\nconst product = window?.scData?.product_data?.product || null;\nconst prices = product?.prices?.data || [];\nconst selectedPrice = (prices || []).sort((a, b) => a?.position - b?.position).find(price => !price?.archived);\nconst adHocAmount = selectedPrice?.amount || null;\n\nconst store = createStore<Store>(\n  {\n    formId: window?.scData?.product_data?.form?.ID,\n    mode: window?.scData?.product_data?.mode || 'live',\n    product,\n    prices,\n    quantity: 1,\n    selectedPrice,\n    total: null,\n    dialog: null,\n    busy: false,\n    disabled: selectedPrice?.archived || product?.archived,\n    adHocAmount,\n    error: null,\n    checkoutUrl: window?.scData?.product_data?.checkout_link,\n    line_item: {\n      price_id: selectedPrice?.id,\n      quantity: 1,\n      ...(selectedPrice?.ad_hoc ? { ad_hoc_amount: adHocAmount } : {}),\n    },\n  },\n  (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nconst { state, onChange, on, dispose, forceUpdate } = store;\nexport default state;\nexport { state, onChange, on, dispose, forceUpdate };\n\nif (window?.sc?.store) {\n  window.sc.store.product = store;\n}\n","import state, { onChange } from './store';\n\nonChange('selectedPrice', value => {\n  // update the total when the selected price changes.\n  state.total = state.adHocAmount || value?.amount || 0;\n  // set the ad hoc amount to the selected product amount.\n  state.adHocAmount = value?.amount;\n  // update disabled based on if price is archived or product is archived.\n  state.disabled = value?.archived || state.product?.archived;\n});\n\n// update the line item when any of these change.\nonChange('selectedPrice', () => setLineItem());\nonChange('adHocAmount', () => setLineItem());\nonChange('quantity', () => setLineItem());\n\nconst setLineItem = () => {\n  state.line_item = {\n    price_id: state.selectedPrice?.id,\n    quantity: state.selectedPrice?.ad_hoc ? 1 : state.quantity,\n    ...(state.selectedPrice?.ad_hoc ? { ad_hoc_amount: state.adHocAmount } : {}),\n  };\n};\n"],"mappings":"8DAoBA,MAAMA,IAAUC,GAAAC,EAAAC,SAAM,MAANA,cAAM,SAANA,OAAQC,UAAM,MAAAF,SAAA,SAAAA,EAAEG,gBAAY,MAAAJ,SAAA,SAAAA,EAAED,UAAW,KACzD,MAAMM,IAASC,EAAAP,IAAO,MAAPA,SAAO,SAAPA,EAASM,UAAM,MAAAC,SAAA,SAAAA,EAAEC,OAAQ,GACxC,MAAMC,GAAiBH,GAAU,IAAII,MAAK,CAACC,EAAGC,KAAMD,IAAC,MAADA,SAAC,SAADA,EAAGE,WAAWD,IAAC,MAADA,SAAC,SAADA,EAAGC,YAAUC,MAAKC,KAAUA,IAAK,MAALA,SAAK,SAALA,EAAOC,YACrG,MAAMC,GAAcR,IAAa,MAAbA,SAAa,SAAbA,EAAeS,SAAU,KAE7C,MAAMC,EAAQC,EACZ,CACEC,QAAQC,GAAAC,GAAAC,EAAArB,SAAM,MAANA,cAAM,SAANA,OAAQC,UAAM,MAAAoB,SAAA,SAAAA,EAAEnB,gBAAY,MAAAkB,SAAA,SAAAA,EAAEE,QAAI,MAAAH,SAAA,SAAAA,EAAEI,GAC5CC,OAAMC,GAAAC,EAAA1B,SAAM,MAANA,cAAM,SAANA,OAAQC,UAAM,MAAAyB,SAAA,SAAAA,EAAExB,gBAAY,MAAAuB,SAAA,SAAAA,EAAED,OAAQ,OAC5C3B,UACAM,SACAwB,SAAU,EACVrB,gBACAsB,MAAO,KACPC,OAAQ,KACRC,KAAM,MACNC,UAAUzB,IAAa,MAAbA,SAAa,SAAbA,EAAeO,YAAYhB,IAAO,MAAPA,SAAO,SAAPA,EAASgB,UAC9CC,cACAkB,MAAO,KACPC,aAAaC,GAAAC,EAAAnC,SAAM,MAANA,cAAM,SAANA,OAAQC,UAAM,MAAAkC,SAAA,SAAAA,EAAEjC,gBAAY,MAAAgC,SAAA,SAAAA,EAAEE,cAC3CC,UAAW,CACTC,SAAUhC,IAAa,MAAbA,SAAa,SAAbA,EAAeiC,GACzBZ,SAAU,MACNrB,IAAa,MAAbA,SAAa,SAAbA,EAAekC,QAAS,CAAEC,cAAe3B,GAAgB,MAGjE,CAAC4B,EAAUC,IACFC,KAAKC,UAAUH,KAAcE,KAAKC,UAAUF,K,MAIjDG,MAAEA,EAAKC,SAAEA,EAAQC,GAAEA,EAAEC,QAAEA,EAAOC,YAAEA,GAAgBlC,EAItD,IAAImC,EAAAnD,SAAM,MAANA,cAAM,SAANA,OAAQoD,MAAE,MAAAD,SAAA,SAAAA,EAAEnC,MAAO,CACrBhB,OAAOoD,GAAGpC,MAAMnB,QAAUmB,C,CCtD5B+B,EAAS,iBAAiBM,I,MAExBP,EAAMlB,MAAQkB,EAAMhC,cAAeuC,IAAK,MAALA,SAAK,SAALA,EAAOtC,SAAU,EAEpD+B,EAAMhC,YAAcuC,IAAK,MAALA,SAAK,SAALA,EAAOtC,OAE3B+B,EAAMf,UAAWsB,IAAK,MAALA,SAAK,SAALA,EAAOxC,aAAYd,EAAA+C,EAAMjD,WAAO,MAAAE,SAAA,SAAAA,EAAEc,SAAQ,IAI7DkC,EAAS,iBAAiB,IAAMO,MAChCP,EAAS,eAAe,IAAMO,MAC9BP,EAAS,YAAY,IAAMO,MAE3B,MAAMA,EAAc,K,UAClBR,EAAMT,UAAY,CAChBC,UAAUvC,EAAA+C,EAAMxC,iBAAa,MAAAP,SAAA,SAAAA,EAAEwC,GAC/BZ,WAAU7B,EAAAgD,EAAMxC,iBAAa,MAAAR,SAAA,SAAAA,EAAE0C,QAAS,EAAIM,EAAMnB,cAC9CvB,EAAA0C,EAAMxC,iBAAa,MAAAF,SAAA,SAAAA,EAAEoC,QAAS,CAAEC,cAAeK,EAAMhC,aAAgB,GAC1E,S"}