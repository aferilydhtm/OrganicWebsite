import{r as o,h as i}from"./p-25a9e68f.js";import{a as l}from"./p-d8453138.js";import{a as s}from"./p-1c2e2695.js";const d=":host{display:block}.purchase{display:flex;flex-direction:column;gap:var(--sc-spacing-large)}.single-download .single-download__preview{display:flex;align-items:center;justify-content:center;background:var(--sc-color-gray-200);border-radius:var(--sc-border-radius-small);height:4rem;min-width:4rem;width:4rem}";const n=class{constructor(l){o(this,l);this.renderFileExt=o=>{var l,s,d,n,e,t,a,r,u;if((l=o===null||o===void 0?void 0:o.media)===null||l===void 0?void 0:l.filename){return(e=(n=(d=(s=o.media.filename).split)===null||d===void 0?void 0:d.call(s,"."))===null||n===void 0?void 0:n.pop)===null||e===void 0?void 0:e.call(n)}if(o===null||o===void 0?void 0:o.url){try{const i=new URL(o.url);if(i.pathname.includes(".")){return(u=(r=(a=(t=i.pathname).split)===null||a===void 0?void 0:a.call(t,"."))===null||r===void 0?void 0:r.pop)===null||u===void 0?void 0:u.call(r)}}catch(o){console.error(o)}}return i("sc-icon",{name:"file"})};this.downloads=undefined;this.customerId=undefined;this.heading=undefined;this.busy=undefined;this.error=undefined}async downloadItem(o){var i,d;if(o===null||o===void 0?void 0:o.url){this.downloadFile(o.url,(i=o===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:"file");return}const n=(d=o===null||o===void 0?void 0:o.media)===null||d===void 0?void 0:d.id;if(!n)return;try{this.busy=n;const o=await l({path:s(`surecart/v1/customers/${this.customerId}/expose/${n}`,{expose_for:60})});if(!(o===null||o===void 0?void 0:o.url)){throw{message:wp.i18n.__("Could not download the file.","surecart")}}this.downloadFile(o===null||o===void 0?void 0:o.url,o.filename)}catch(o){console.error(o);this.error=(o===null||o===void 0?void 0:o.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=null}}downloadFile(o,i){const l=document.createElement("a");l.href=o;l.download=i;document.body.appendChild(l);l.click();setTimeout((()=>{document.body.removeChild(l)}),0)}render(){const o=this.downloads||[];return i("sc-dashboard-module",{class:"purchase",part:"base",heading:wp.i18n.__("Downloads","surecart")},i("span",{slot:"heading"},i("slot",{name:"heading"},this.heading||wp.i18n.__("Downloads","surecart"))),i("sc-card",{"no-padding":true},i("sc-stacked-list",null,o.map((o=>{var l,s,d,n;const e=o===null||o===void 0?void 0:o.media;return i("sc-stacked-list-row",{style:{"--columns":"1"}},i("sc-flex",{class:"single-download",justifyContent:"flex-start",alignItems:"center"},i("div",{class:"single-download__preview"},this.renderFileExt(o)),i("div",null,i("div",null,i("strong",null,(s=(l=e===null||e===void 0?void 0:e.filename)!==null&&l!==void 0?l:o===null||o===void 0?void 0:o.name)!==null&&s!==void 0?s:"")),i("sc-flex",{justifyContent:"flex-start",alignItems:"center",style:{gap:"0.5em"}},(e===null||e===void 0?void 0:e.byte_size)&&i("sc-format-bytes",{value:e.byte_size}),!!((d=e===null||e===void 0?void 0:e.release_json)===null||d===void 0?void 0:d.version)&&i("sc-tag",{type:"primary",size:"small",style:{"--sc-tag-primary-background-color":"#f3e8ff","--sc-tag-primary-color":"#6b21a8"}},"v",(n=e===null||e===void 0?void 0:e.release_json)===null||n===void 0?void 0:n.version)))),i("sc-button",{size:"small",slot:"suffix",onClick:()=>this.downloadItem(o),busy:(e===null||e===void 0?void 0:e.id)?this.busy==(e===null||e===void 0?void 0:e.id):false,disabled:(e===null||e===void 0?void 0:e.id)?this.busy==(e===null||e===void 0?void 0:e.id):false},wp.i18n.__("Download","surecart")))})))))}};n.style=d;export{n as sc_downloads_list};
//# sourceMappingURL=p-f19c51b6.entry.js.map