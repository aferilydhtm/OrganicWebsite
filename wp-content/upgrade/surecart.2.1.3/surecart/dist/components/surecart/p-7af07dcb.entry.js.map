{"version":3,"names":["iconFiles","Map","requestIcon","url","has","get","request","fetch","then","async","response","ok","div","document","createElement","innerHTML","text","svg","firstElementChild","status","tagName","toLowerCase","outerHTML","set","scIconCss","parser","DOMParser","ScIcon","redraw","this","setIcon","componentWillLoad","getLabel","label","name","replace","src","library","getIconLibrary","getUrl","file","doc","parseFromString","svgEl","body","querySelector","mutator","scLoad","emit","scError","resolver","render","h","part","class","role"],"sources":["./src/components/ui/icon/request.ts","./src/components/ui/icon/sc-icon.css?tag=sc-icon&encapsulation=shadow","./src/components/ui/icon/sc-icon.tsx"],"sourcesContent":["interface IconFile {\n  ok: boolean;\n  status: number;\n  svg: string;\n}\n\nconst iconFiles = new Map<string, Promise<IconFile>>();\n\nexport const requestIcon = (url: string) => {\n  if (iconFiles.has(url)) {\n    return iconFiles.get(url);\n  } else {\n    const request = fetch(url).then(async response => {\n      if (response.ok) {\n        const div = document.createElement('div');\n        div.innerHTML = await response.text();\n        const svg = div.firstElementChild;\n\n        return {\n          ok: response.ok,\n          status: response.status,\n          svg: svg && svg.tagName.toLowerCase() === 'svg' ? svg.outerHTML : '',\n        };\n      } else {\n        return {\n          ok: response.ok,\n          status: response.status,\n          svg: null,\n        };\n      }\n    }) as Promise<IconFile>;\n\n    iconFiles.set(url, request);\n    return request;\n  }\n};\n",":host {\n  --width: 1em;\n  --height: 1em;\n  display: inline-block;\n  width: var(--width);\n  height: var(--height);\n  contain: strict;\n  box-sizing: content-box !important;\n}\n.icon,\nsvg {\n  display: block;\n  height: 100%;\n  width: 100%;\n  stroke-width: var(--sc-icon-stroke-width, 2px);\n}\n","import { Component, Watch, h, Prop, State, Event, EventEmitter } from '@stencil/core';\nimport { getIconLibrary } from './library';\nimport { requestIcon } from './request';\n\nconst parser = new DOMParser();\n\n@Component({\n  tag: 'sc-icon',\n  styleUrl: 'sc-icon.css',\n  assetsDirs: ['icon-assets'],\n  shadow: true,\n})\nexport class ScIcon {\n  @State() private svg = '';\n\n  /** The name of the icon to draw. */\n  @Prop({ reflect: true }) name: string;\n\n  /** An external URL of an SVG file. */\n  @Prop() src: string;\n\n  /** An alternative description to use for accessibility. If omitted, the name or src will be used to generate it. */\n  @Prop() label: string;\n\n  /** The name of a registered custom icon library. */\n  @Prop() library = 'default';\n\n  /** Emitted when the icon has loaded. */\n  @Event() scLoad: EventEmitter<void>;\n\n  /** Emitted when the icon failed to load.  */\n  @Event() scError: EventEmitter<{ status: number }>;\n\n  /** @internal Fetches the icon and redraws it. Used to handle library registrations. */\n  redraw() {\n    this.setIcon();\n  }\n\n  componentWillLoad() {\n    this.setIcon();\n  }\n\n  getLabel() {\n    let label = '';\n    if (this.label) {\n      label = this.label;\n    } else if (this.name) {\n      label = this.name.replace(/-/g, ' ');\n    } else if (this.src) {\n      label = this.src.replace(/.*\\//, '').replace(/-/g, ' ').replace(/\\.svg/i, '');\n    }\n\n    return label;\n  }\n\n  @Watch('name')\n  @Watch('src')\n  @Watch('library')\n  async setIcon() {\n    const library = getIconLibrary(this.library);\n    const url = this.getUrl();\n    if (url) {\n      try {\n        const file = await requestIcon(url)!;\n        if (url !== this.getUrl()) {\n          // If the url has changed while fetching the icon, ignore this request\n          return;\n        } else if (file.ok) {\n          const doc = parser.parseFromString(file.svg, 'text/html');\n          const svgEl = doc.body.querySelector('svg');\n\n          if (svgEl) {\n            if (library && library.mutator) {\n              library.mutator(svgEl);\n            }\n\n            this.svg = svgEl.outerHTML;\n            this.scLoad.emit();\n          } else {\n            this.svg = '';\n            this.scError.emit({ status: file.status });\n          }\n        } else {\n          this.svg = '';\n          this.scError.emit({ status: file.status });\n        }\n      } catch {\n        this.scError.emit({ status: -1 });\n      }\n    } else if (this.svg) {\n      // If we can't resolve a URL and an icon was previously set, remove it\n      this.svg = '';\n    }\n  }\n\n  private getUrl(): string {\n    const library = getIconLibrary(this.library);\n    if (this.name && library) {\n      return library.resolver(this.name);\n    } else {\n      return this.src;\n    }\n  }\n\n  render() {\n    return <div part=\"base\" class=\"icon\" role=\"img\" aria-label={this.getLabel()} innerHTML={this.svg}></div>;\n  }\n}\n"],"mappings":"sFAMA,MAAMA,EAAY,IAAIC,IAEf,MAAMC,EAAeC,IAC1B,GAAIH,EAAUI,IAAID,GAAM,CACtB,OAAOH,EAAUK,IAAIF,E,KAChB,CACL,MAAMG,EAAUC,MAAMJ,GAAKK,MAAKC,MAAMC,IACpC,GAAIA,EAASC,GAAI,CACf,MAAMC,EAAMC,SAASC,cAAc,OACnCF,EAAIG,gBAAkBL,EAASM,OAC/B,MAAMC,EAAML,EAAIM,kBAEhB,MAAO,CACLP,GAAID,EAASC,GACbQ,OAAQT,EAASS,OACjBF,IAAKA,GAAOA,EAAIG,QAAQC,gBAAkB,MAAQJ,EAAIK,UAAY,G,KAE/D,CACL,MAAO,CACLX,GAAID,EAASC,GACbQ,OAAQT,EAASS,OACjBF,IAAK,K,KAKXjB,EAAUuB,IAAIpB,EAAKG,GACnB,OAAOA,C,GCjCX,MAAMkB,EAAY,6OCIlB,MAAMC,EAAS,IAAIC,U,MAQNC,EAAM,M,kGACM,G,yEAYL,S,CASlBC,SACEC,KAAKC,S,CAGPC,oBACEF,KAAKC,S,CAGPE,WACE,IAAIC,EAAQ,GACZ,GAAIJ,KAAKI,MAAO,CACdA,EAAQJ,KAAKI,K,MACR,GAAIJ,KAAKK,KAAM,CACpBD,EAAQJ,KAAKK,KAAKC,QAAQ,KAAM,I,MAC3B,GAAIN,KAAKO,IAAK,CACnBH,EAAQJ,KAAKO,IAAID,QAAQ,OAAQ,IAAIA,QAAQ,KAAM,KAAKA,QAAQ,SAAU,G,CAG5E,OAAOF,C,CAMTxB,gBACE,MAAM4B,EAAUC,EAAeT,KAAKQ,SACpC,MAAMlC,EAAM0B,KAAKU,SACjB,GAAIpC,EAAK,CACP,IACE,MAAMqC,QAAatC,EAAYC,GAC/B,GAAIA,IAAQ0B,KAAKU,SAAU,CAEzB,M,MACK,GAAIC,EAAK7B,GAAI,CAClB,MAAM8B,EAAMhB,EAAOiB,gBAAgBF,EAAKvB,IAAK,aAC7C,MAAM0B,EAAQF,EAAIG,KAAKC,cAAc,OAErC,GAAIF,EAAO,CACT,GAAIN,GAAWA,EAAQS,QAAS,CAC9BT,EAAQS,QAAQH,E,CAGlBd,KAAKZ,IAAM0B,EAAMrB,UACjBO,KAAKkB,OAAOC,M,KACP,CACLnB,KAAKZ,IAAM,GACXY,KAAKoB,QAAQD,KAAK,CAAE7B,OAAQqB,EAAKrB,Q,MAE9B,CACLU,KAAKZ,IAAM,GACXY,KAAKoB,QAAQD,KAAK,CAAE7B,OAAQqB,EAAKrB,Q,EAEnC,MACAU,KAAKoB,QAAQD,KAAK,CAAE7B,QAAS,G,OAE1B,GAAIU,KAAKZ,IAAK,CAEnBY,KAAKZ,IAAM,E,EAIPsB,SACN,MAAMF,EAAUC,EAAeT,KAAKQ,SACpC,GAAIR,KAAKK,MAAQG,EAAS,CACxB,OAAOA,EAAQa,SAASrB,KAAKK,K,KACxB,CACL,OAAOL,KAAKO,G,EAIhBe,SACE,OAAOC,EAAA,OAAKC,KAAK,OAAOC,MAAM,OAAOC,KAAK,MAAK,aAAa1B,KAAKG,WAAYjB,UAAWc,KAAKZ,K"}