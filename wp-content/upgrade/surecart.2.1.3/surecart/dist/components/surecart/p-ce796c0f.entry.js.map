{"version":3,"names":["scCartCss","ScCart","handleOpenChange","uiStore","set","state","cart","open","this","fetchOrder","order","getOrder","formId","mode","setOrder","data","pageHasForm","document","querySelector","getItemsCount","items","_b","_a","line_items","count","forEach","item","quantity","handleSetState","e","uiState","detail","handleErrorEvent","error","handleCloseCart","async","apiFetch","method","path","addQueryArgs","baseUrl","id","expand","console","componentWillLoad","Universe","create","onChange","checkoutState","processor_data","checkoutLink","loading","busy","navigating","empty","_d","_c","pagination","lineItems","_f","_e","tax_status","_g","customerShippingAddress","_h","customer","_k","_j","shipping_address","shippingAddress","_l","taxStatus","_m","render","h","Fragment","Provider","onScUpdateOrderState","onScError","onScAfterHide","onScAfterShow","class","slot","name","style","onScUpdateError"],"sources":["./src/components/controllers/cart/sc-cart/sc-cart.scss?tag=sc-cart&encapsulation=shadow","./src/components/controllers/cart/sc-cart/sc-cart.tsx"],"sourcesContent":[":host {\n  --sc-drawer-header-spacing: var(--sc-spacing-large);\n  --sc-drawer-body-spacing: var(--sc-spacing-large);\n  --sc-drawer-footer-spacing: var(--sc-spacing-large);\n}\n\n.cart {\n  font-size: 16px;\n}\n\n.cart__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  font-size: 1em;\n}\n.cart__close {\n  opacity: 0.75;\n  transition: opacity 0.25s ease;\n  cursor: pointer;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n::slotted(*) {\n  padding: var(--sc-drawer-header-spacing);\n  background:  var(--sc-panel-background-color);\n  position: relative;\n}\n\n::slotted(sc-line-items) {\n  flex: 1 1 auto;\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  min-height: 200px;\n}\n::slotted(:last-child) {\n  border-bottom: 0 !important;\n}\n\nsc-drawer::part(body) {\n  display: flex;\n  flex-direction: column;\n  box-sizing: border-box;\n  padding:0;\n  overflow: hidden;\n}\n","import { Component, Fragment, h, Listen, Prop, State, Watch } from '@stencil/core';\nimport apiFetch from '../../../../functions/fetch';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\nimport { Creator, Universe } from 'stencil-wormhole';\nimport { baseUrl } from '../../../../services/session';\nimport { getOrder, setOrder } from '@store/checkouts';\nimport { state as checkoutState } from '@store/checkout';\nimport uiStore from '@store/ui';\nimport { expand } from '../../../../services/session';\nimport { Checkout, ResponseError } from '../../../../types';\n\n@Component({\n  tag: 'sc-cart',\n  styleUrl: 'sc-cart.scss',\n  shadow: true,\n})\nexport class ScCart {\n  /** Is this open or closed? */\n  @State() open: boolean = null;\n\n  /** The form id to use for the cart. */\n  @Prop({ reflect: true }) formId: string;\n\n  /** The header for the popout. */\n  @Prop() header: string;\n\n  @Prop() checkoutLink: string;\n\n  /** The template for the cart to inject when opened. */\n  @Prop() cartTemplate: string;\n\n  /** Are we in test or live mode. */\n  @Prop() mode: 'test' | 'live' = 'live';\n\n  /** The checkout url for the button. */\n  @Prop() checkoutUrl: string;\n\n  /** Should we force show the cart, even if there's a form on the page? */\n  @Prop() alwaysShow: boolean;\n\n  /** Whether the floating button should be visible */\n  @Prop() floatingIconEnabled: boolean = true;\n\n  /** The current UI state. */\n  @State() uiState: 'loading' | 'busy' | 'navigating' | 'idle' = 'idle';\n\n  /** Error state. */\n  @State() error: ResponseError | null;\n\n  @Watch('open')\n  handleOpenChange() {\n    uiStore.set('cart', { ...uiStore.state.cart, ...{ open: this.open } });\n    if (this.open === true) {\n      this.fetchOrder();\n    }\n  }\n\n  order() {\n    return getOrder(this.formId, this.mode);\n  }\n\n  setOrder(data) {\n    setOrder(data, this.formId);\n  }\n\n  /**\n   * Search for the sc-checkout component on a page to make sure\n   * we don't show the cart on a checkout page.\n   */\n  pageHasForm() {\n    return !!document.querySelector('sc-checkout');\n  }\n\n  /** Count the number of items in the cart. */\n  getItemsCount() {\n    const items = this.order()?.line_items?.data;\n    let count = 0;\n    (items || []).forEach(item => {\n      count = count + item?.quantity;\n    });\n    return count;\n  }\n\n  @Listen('scSetState')\n  handleSetState(e) {\n    this.uiState = e.detail;\n  }\n\n  /** Listen for error events in component. */\n  @Listen('scError')\n  handleErrorEvent(e) {\n    this.error = e.detail as ResponseError;\n    this.uiState = 'idle';\n  }\n\n  @Listen('scCloseCart')\n  handleCloseCart() {\n    this.open = false;\n  }\n\n  /** Fetch the order */\n  async fetchOrder() {\n    try {\n      this.uiState = 'loading';\n      const order = (await apiFetch({\n        method: 'GET', // create or update\n        path: addQueryArgs(`${baseUrl}${this.order()?.id}`, {\n          expand,\n        }),\n      })) as Checkout;\n      this.setOrder(order);\n    } catch (e) {\n      console.error(e);\n      throw e;\n    } finally {\n      this.uiState = 'idle';\n    }\n  }\n\n  componentWillLoad() {\n    Universe.create(this as Creator, this.state());\n    this.open = !!uiStore.state.cart.open;\n    uiStore.onChange('cart', cart => {\n      this.open = cart.open;\n    });\n    checkoutState.mode = this.mode;\n  }\n\n  state() {\n    return {\n      processor_data: this.order()?.processor_data,\n      uiState: this.uiState,\n      checkoutLink: this.checkoutLink,\n      loading: this.uiState === 'loading',\n      busy: this.uiState === 'busy',\n      navigating: this.uiState === 'navigating',\n      empty: !this.order()?.line_items?.pagination?.count,\n      error: this.error,\n      order: this.order(),\n      lineItems: this.order()?.line_items?.data || [],\n      tax_status: this.order()?.tax_status,\n      customerShippingAddress: typeof this.order()?.customer !== 'string' ? this.order()?.customer?.shipping_address : {},\n      shippingAddress: this.order()?.shipping_address,\n      taxStatus: this.order()?.tax_status,\n      formId: this.formId,\n    };\n  }\n\n  render() {\n    return (\n      <Fragment>\n        {this.order() && (\n          <Universe.Provider state={this.state()}>\n            <sc-cart-session-provider\n              order={this.order()}\n              form-id={this.formId}\n              group-id={this.formId}\n              onScUpdateOrderState={e => this.setOrder(e.detail)}\n              onScError={e => (this.error = e.detail as ResponseError)}\n            >\n              <sc-drawer open={this.open} onScAfterHide={() => (this.open = false)} onScAfterShow={() => (this.open = true)}>\n                {this.open === true && (\n                  <Fragment>\n                    <div class=\"cart__header-suffix\" slot=\"header\">\n                      <slot name=\"cart-header\" />\n                      <sc-error style={{ '--sc-alert-border-radius': '0' }} slot=\"header\" error={this.error} onScUpdateError={e => (this.error = e.detail)}></sc-error>\n                    </div>\n                    <slot />\n                  </Fragment>\n                )}\n                {this.uiState === 'busy' && <sc-block-ui z-index={9}></sc-block-ui>}\n              </sc-drawer>\n            </sc-cart-session-provider>\n          </Universe.Provider>\n        )}\n      </Fragment>\n    );\n  }\n}\n"],"mappings":"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"}