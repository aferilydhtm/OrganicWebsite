import{r as t,h as e,F as i,a as s}from"./p-25a9e68f.js";import{a as n}from"./p-d8453138.js";import{o as r}from"./p-c2833cb1.js";import{a as o}from"./p-1c2e2695.js";import{g as c}from"./p-4d73f82a.js";const a=":host{display:block}.subscription{display:grid;gap:0.5em}.subscription a{text-decoration:none;font-weight:var(--sc-font-weight-semibold);display:inline-flex;align-items:center;gap:0.25em;color:var(--sc-color-primary-500)}.subscription a.cancel{color:var(--sc-color-danger-500)}";const d=class{constructor(e){t(this,e);this.subscriptionId=undefined;this.showCancel=undefined;this.heading=undefined;this.query=undefined;this.protocol=undefined;this.subscription=undefined;this.loading=undefined;this.cancelModal=undefined;this.busy=undefined;this.error=undefined}componentWillLoad(){r(this.el,(()=>{if(!this.subscription){this.getSubscription()}}))}async cancelPendingUpdate(){var t;const e=confirm(wp.i18n.__("Are you sure you want to cancel the pending update to your plan?","surecart"));if(!e)return;try{this.busy=true;this.subscription=await n({path:o(`surecart/v1/subscriptions/${(t=this.subscription)===null||t===void 0?void 0:t.id}/`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH",data:{purge_pending_update:true}})}catch(t){if(t===null||t===void 0?void 0:t.message){this.error=t.message}else{this.error=wp.i18n.__("Something went wrong","surecart")}console.error(this.error)}finally{this.busy=false}}async renewSubscription(){var t;try{this.error="";this.busy=true;this.subscription=await n({path:o(`surecart/v1/subscriptions/${(t=this.subscription)===null||t===void 0?void 0:t.id}/renew`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH"})}catch(t){this.error=(t===null||t===void 0?void 0:t.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=false}}async getSubscription(){var t;try{this.loading=true;this.subscription=await await n({path:o(`surecart/v1/subscriptions/${this.subscriptionId||((t=this.subscription)===null||t===void 0?void 0:t.id)}`,{expand:["price","price.product","current_period"],...this.query||{}})})}catch(t){if(t===null||t===void 0?void 0:t.message){this.error=t.message}else{this.error=wp.i18n.__("Something went wrong","surecart")}console.error(this.error)}finally{this.loading=false}}renderName(t){var e,i,s;if(typeof((e=t===null||t===void 0?void 0:t.price)===null||e===void 0?void 0:e.product)!=="string"){return(s=(i=t===null||t===void 0?void 0:t.price)===null||i===void 0?void 0:i.product)===null||s===void 0?void 0:s.name}return wp.i18n.__("Subscription","surecart")}renderRenewalText(t){const i=e("sc-subscription-status-badge",{subscription:t});if((t===null||t===void 0?void 0:t.cancel_at_period_end)&&t.current_period_end_at){return e("span",null,i," ",wp.i18n.sprintf(wp.i18n.__("Your plan will be canceled on","surecart"))," ",e("sc-format-date",{date:t.current_period_end_at*1e3,month:"long",day:"numeric",year:"numeric"}))}if(t.status==="trialing"&&t.trial_end_at){return e("span",null,i," ",wp.i18n.sprintf(wp.i18n.__("Your plan begins on","surecart"))," ",e("sc-format-date",{date:t.trial_end_at*1e3,month:"long",day:"numeric",year:"numeric"}))}if(t.status==="active"&&t.current_period_end_at){return e("span",null,i," ",wp.i18n.sprintf(wp.i18n.__("Your plan renews on","surecart"))," ",e("sc-format-date",{date:t.current_period_end_at*1e3,month:"long",day:"numeric",year:"numeric"}))}return i}renderEmpty(){return e("slot",{name:"empty"},wp.i18n.__("This subscription does not exist.","surecart"))}renderLoading(){return e("sc-stacked-list-row",{style:{"--columns":"2"},"mobile-size":0},e("div",{style:{padding:"0.5em"}},e("sc-skeleton",{style:{width:"30%",marginBottom:"0.75em"}}),e("sc-skeleton",{style:{width:"20%",marginBottom:"0.75em"}}),e("sc-skeleton",{style:{width:"40%"}})))}renderContent(){if(this.loading){return this.renderLoading()}if(!this.subscription){return this.renderEmpty()}return e(i,null,e("sc-subscription-next-payment",{subscription:this.subscription},e("sc-subscription-details",{subscription:this.subscription})))}render(){var t,i,s,n;return e("sc-dashboard-module",{heading:this.heading||wp.i18n.__("Current Plan","surecart"),class:"subscription",error:this.error},!!this.subscription&&e("sc-flex",{slot:"end"},c(window.location.href,"action")!=="update_payment_method"&&e("sc-button",{type:"link",href:o(window.location.href,{action:"update_payment_method"})},e("sc-icon",{name:"credit-card",slot:"prefix"}),wp.i18n.__("Update Payment Method","surecart")),!!Object.keys((t=this.subscription)===null||t===void 0?void 0:t.pending_update).length&&e("sc-button",{type:"link",onClick:()=>this.cancelPendingUpdate()},e("sc-icon",{name:"x-octagon",slot:"prefix"}),wp.i18n.__("Cancel Scheduled Update","surecart")),((i=this===null||this===void 0?void 0:this.subscription)===null||i===void 0?void 0:i.cancel_at_period_end)?e("sc-button",{type:"link",onClick:()=>this.renewSubscription()},e("sc-icon",{name:"repeat",slot:"prefix"}),wp.i18n.__("Restore Plan","surecart")):((s=this.subscription)===null||s===void 0?void 0:s.status)!=="canceled"&&((n=this.subscription)===null||n===void 0?void 0:n.current_period_end_at)&&this.showCancel&&e("sc-button",{type:"link",onClick:()=>this.cancelModal=true},e("sc-icon",{name:"x",slot:"prefix"}),wp.i18n.__("Cancel Plan","surecart"))),e("sc-card",{style:{"--overflow":"hidden"},noPadding:true},this.renderContent()),this.busy&&e("sc-block-ui",{spinner:true}),e("sc-cancel-dialog",{subscription:this.subscription,protocol:this.protocol,open:this.cancelModal,onScRequestClose:()=>this.cancelModal=false,onScRefresh:()=>this.getSubscription()}))}get el(){return s(this)}};d.style=a;export{d as sc_subscription};
//# sourceMappingURL=p-38b961a3.entry.js.map