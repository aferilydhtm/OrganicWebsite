import{r as t,c as e,h as r,a as s}from"./p-25a9e68f.js";import{u as a}from"./p-62338837.js";import{g as i,a as o,s as n,c as d}from"./p-89fa6499.js";import"./p-b6ef0098.js";import"./p-db7ede86.js";import"./p-1c2e2695.js";import"./p-61ab3f3a.js";import"./p-4c5e6c8d.js";import"./p-7c27060f.js";import"./p-6c2a2148.js";import"./p-d8453138.js";import"./p-4d73f82a.js";const l=class{constructor(r){t(this,r);this.scUpdateOrderState=e(this,"scUpdateOrderState",7);this.scError=e(this,"scError",7);this.scSetState=e(this,"scSetState",7);this.order=undefined;this.session=undefined}handleSessionUpdate(t){this.scUpdateOrderState.emit(t)}handleUpdateSession(t){const{data:e,options:r}=t.detail;if(r===null||r===void 0?void 0:r.silent){this.update(e)}else{this.loadUpdate(e)}}async handleCouponApply(t){const e=t.detail;this.scError.emit({});this.loadUpdate({discount:{...e?{promotion_code:e}:{}}})}handleErrorResponse(t){var e,r;if((t===null||t===void 0?void 0:t.code)==="readonly"||((r=(e=t===null||t===void 0?void 0:t.additional_errors)===null||e===void 0?void 0:e[0])===null||r===void 0?void 0:r.code)==="checkout.customer.account_mismatch"){this.scUpdateOrderState.emit(null)}if((t===null||t===void 0?void 0:t.code)==="rest_cookie_invalid_nonce"){this.scSetState.emit("idle");return}if(t===null||t===void 0?void 0:t.message){this.scError.emit(t)}if((t===null||t===void 0?void 0:t.code)==="http_request_failed"){this.scError.emit({message:"Something went wrong. Please reload the page and try again."})}this.scSetState.emit("idle")}async fetch(t={}){this.loadUpdate({status:"draft",...t})}async update(t={},e={}){var r;try{this.session=await a({id:(r=this.order)===null||r===void 0?void 0:r.id,data:{...t},query:{...e}})}catch(t){console.error(t);throw t}}async loadUpdate(t={}){try{this.scSetState.emit("busy");await this.update(t);this.scSetState.emit("idle")}catch(t){this.handleErrorResponse(t)}}render(){return r("sc-line-items-provider",{order:this.order,onScUpdateLineItems:t=>this.loadUpdate({line_items:t.detail})},r("slot",null))}get el(){return s(this)}static get watchers(){return{session:["handleSessionUpdate"]}}};const h=":host{display:contents}.drawer{top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;font-family:var(--sc-font-sans);font-weight:var(--sc-font-weight-normal)}.drawer--contained{position:absolute;z-index:initial}.drawer--fixed{position:fixed;z-index:var(--sc-z-index-drawer)}.drawer__panel{position:absolute;display:flex;flex-direction:column;z-index:2;max-width:100%;max-height:100%;background-color:var(--sc-panel-background-color);box-shadow:var(--sc-shadow-x-large);transition:var(--sc-transition-medium) transform;overflow:auto;pointer-events:all}.drawer__panel:focus{outline:none}.drawer--top .drawer__panel{top:0;right:auto;bottom:auto;left:0;width:100%;height:var(--sc-drawer-size, 400px)}.drawer--end .drawer__panel{top:0;right:0;bottom:auto;left:auto;width:100%;max-width:var(--sc-drawer-size, 400px);height:100%}.drawer--bottom .drawer__panel{top:auto;right:auto;bottom:0;left:0;width:100%;height:var(--sc-drawer-size, 400px)}.drawer--start .drawer__panel{top:0;right:auto;bottom:auto;left:0;width:var(--sc-drawer-size, 400px);height:100%}.drawer__header{display:flex;align-items:center;padding:var(--sc-drawer-header-spacing);border-bottom:var(--sc-drawer-border)}.drawer__title{flex:1 1 auto;font:inherit;font-size:var(--sc-font-size-large);line-height:var(--sc-line-height-dense);margin:0}.drawer__close{flex:0 0 auto;display:flex;align-items:center;font-size:var(--sc-font-size-x-large);color:var(--sc-color-gray-500);cursor:pointer}.drawer__body{flex:1 1 auto}.drawer--has-footer .drawer__footer{border-top:var(--sc-drawer-border);padding:var(--sc-drawer-footer-spacing)}.drawer__overlay{display:block;position:fixed;top:0;right:0;bottom:0;left:0;background-color:var(--sc-overlay-background-color);pointer-events:all}.drawer--contained .drawer__overlay{position:absolute}";const c=class{constructor(r){t(this,r);this.scInitialFocus=e(this,"scInitialFocus",7);this.scRequestClose=e(this,"scRequestClose",7);this.scShow=e(this,"scShow",7);this.scHide=e(this,"scHide",7);this.scAfterShow=e(this,"scAfterShow",7);this.scAfterHide=e(this,"scAfterHide",7);this.open=false;this.label="";this.placement="end";this.contained=false;this.noHeader=false}componentDidLoad(){this.drawer.hidden=!this.open;if(this.open&&!this.contained){this.lockBodyScrolling()}}disconnectedCallback(){this.unLockBodyScrolling()}lockBodyScrolling(){document.body.classList.add("sc-scroll-lock")}unLockBodyScrolling(){document.body.classList.remove("sc-scroll-lock")}async show(){if(this.open){return undefined}this.open=true}async hide(){if(!this.open){return undefined}this.open=false}requestClose(t){const e=this.scRequestClose.emit(t);if(e.defaultPrevented){const t=i(this.el,"drawer.denyClose");o(this.panel,t.keyframes,t.options);return}this.hide()}handleKeyDown(t){if(t.key==="Escape"){t.stopPropagation();this.requestClose("keyboard")}}async handleOpenChange(){if(this.open){this.scShow.emit();this.originalTrigger=document.activeElement;if(!this.contained){this.lockBodyScrolling()}const t=this.el.querySelector("[autofocus]");if(t){t.removeAttribute("autofocus")}await Promise.all([n(this.drawer),n(this.overlay)]);this.drawer.hidden=false;requestAnimationFrame((()=>{const e=this.scInitialFocus.emit();if(!e.defaultPrevented){if(t){t.focus({preventScroll:true})}else{this.panel.focus({preventScroll:true})}}if(t){t.setAttribute("autofocus","")}}));const e=i(this.el,`drawer.show${this.placement.charAt(0).toUpperCase()+this.placement.slice(1)}`);const r=i(this.el,"drawer.overlay.show");await Promise.all([o(this.panel,e.keyframes,e.options),o(this.overlay,r.keyframes,r.options)]);this.scAfterShow.emit()}else{this.scHide.emit();this.unLockBodyScrolling();await Promise.all([n(this.drawer),n(this.overlay)]);const t=i(this.el,`drawer.hide${this.placement.charAt(0).toUpperCase()+this.placement.slice(1)}`);const e=i(this.el,"drawer.overlay.hide");await Promise.all([o(this.panel,t.keyframes,t.options),o(this.overlay,e.keyframes,e.options)]);this.drawer.hidden=true;const r=this.originalTrigger;if(typeof(r===null||r===void 0?void 0:r.focus)==="function"){setTimeout((()=>r.focus()))}this.scAfterHide.emit()}}render(){return r("div",{part:"base",class:{drawer:true,"drawer--open":this.open,"drawer--top":this.placement==="top","drawer--end":this.placement==="end","drawer--bottom":this.placement==="bottom","drawer--start":this.placement==="start","drawer--contained":this.contained,"drawer--fixed":!this.contained,"drawer--has-footer":this.el.querySelector('[slot="footer"]')!==null},ref:t=>this.drawer=t,onKeyDown:t=>this.handleKeyDown(t)},r("div",{part:"overlay",class:"drawer__overlay",onClick:()=>this.requestClose("overlay"),tabindex:"-1",ref:t=>this.overlay=t}),r("div",{part:"panel",class:"drawer__panel",role:"dialog","aria-modal":"true","aria-hidden":this.open?"false":"true","aria-label":this.noHeader?this.label:undefined,"aria-labelledby":!this.noHeader?"title":undefined,tabindex:"0",ref:t=>this.panel=t},!this.noHeader&&r("header",{part:"header"},r("slot",{name:"header"},r("div",{class:"drawer__header"},r("h2",{part:"title",class:"drawer__title",id:"title"},r("slot",{name:"label"},this.label.length>0?this.label:" "," ")),r("sc-icon",{part:"close-button",exportparts:"base:close-button__base",class:"drawer__close",name:"x",label:wp.i18n.__("Close","surecart"),onClick:()=>this.requestClose("close-button")})))),r("footer",{part:"header-suffix",class:"drawer__header-suffix"},r("slot",{name:"header-suffix"})),r("div",{part:"body",class:"drawer__body"},r("slot",null)),r("footer",{part:"footer",class:"drawer__footer"},r("slot",{name:"footer"}))))}get el(){return s(this)}static get watchers(){return{open:["handleOpenChange"]}}};d("drawer.showTop",{keyframes:[{opacity:0,transform:"translateY(-100%)"},{opacity:1,transform:"translateY(0)"}],options:{duration:250,easing:"ease"}});d("drawer.hideTop",{keyframes:[{opacity:1,transform:"translateY(0)"},{opacity:0,transform:"translateY(-100%)"}],options:{duration:250,easing:"ease"}});d("drawer.showEnd",{keyframes:[{opacity:0,transform:"translateX(100%)"},{opacity:1,transform:"translateX(0)"}],options:{duration:250,easing:"ease"}});d("drawer.hideEnd",{keyframes:[{opacity:1,transform:"translateX(0)"},{opacity:0,transform:"translateX(100%)"}],options:{duration:250,easing:"ease"}});d("drawer.showBottom",{keyframes:[{opacity:0,transform:"translateY(100%)"},{opacity:1,transform:"translateY(0)"}],options:{duration:250,easing:"ease"}});d("drawer.hideBottom",{keyframes:[{opacity:1,transform:"translateY(0)"},{opacity:0,transform:"translateY(100%)"}],options:{duration:250,easing:"ease"}});d("drawer.showStart",{keyframes:[{opacity:0,transform:"translateX(-100%)"},{opacity:1,transform:"translateX(0)"}],options:{duration:250,easing:"ease"}});d("drawer.hideStart",{keyframes:[{opacity:1,transform:"translateX(0)"},{opacity:0,transform:"translateX(-100%)"}],options:{duration:250,easing:"ease"}});d("drawer.denyClose",{keyframes:[{transform:"scale(1)"},{transform:"scale(1.01)"},{transform:"scale(1)"}],options:{duration:250}});d("drawer.overlay.show",{keyframes:[{opacity:0},{opacity:1}],options:{duration:250,easing:"ease"}});d("drawer.overlay.hide",{keyframes:[{opacity:1},{opacity:0}],options:{duration:250,easing:"ease"}});c.style=h;const p=class{constructor(r){t(this,r);this.scUpdateError=e(this,"scUpdateError",7);this.error=undefined}handleErrorUpdate(t){this.scUpdateError.emit(t)}handleErrorEvent(t){this.error=t.detail}getErrorMessage(t){if(t.code==="order.line_items.price.blank"){return wp.i18n.__("This product is no longer purchasable.","surecart")}return t===null||t===void 0?void 0:t.message}errorMessage(){var t,e,r,s,a,i;if((r=(e=(t=this.error)===null||t===void 0?void 0:t.additional_errors)===null||e===void 0?void 0:e[0])===null||r===void 0?void 0:r.message){return this.getErrorMessage((a=(s=this.error)===null||s===void 0?void 0:s.additional_errors)===null||a===void 0?void 0:a[0])}else if((i=this===null||this===void 0?void 0:this.error)===null||i===void 0?void 0:i.message){return this.getErrorMessage(this===null||this===void 0?void 0:this.error)}return""}render(){return!!this.errorMessage()?r("sc-alert",{exportparts:"base, icon, text, title, message, close",type:"danger",scrollOnOpen:true,open:!!this.errorMessage()},r("span",{slot:"title"},this.errorMessage())):null}static get watchers(){return{error:["handleErrorUpdate"]}}};export{l as sc_cart_session_provider,c as sc_drawer,p as sc_error};
//# sourceMappingURL=p-3fd99451.entry.js.map