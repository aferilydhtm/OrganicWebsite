{"version":3,"names":["scLineItemsCss","ScLineItems","updateQuantity","item","quantity","this","scUpdateLineItem","emit","price_id","price","id","removeLineItem","scRemoveLineItem","getName","otherPrices","Object","keys","prices","filter","key","product","name","length","_b","_a","_c","_e","_d","isLocked","lockedChoices","some","choice","isEditable","ad_hoc","bump_amount","editable","editLineItems","isRemovable","removable","removeLineItems","render","busy","order","line_items","data","h","style","width","height","slot","display","class","sort","a","b","map","imageUrl","image_url","max","_f","purchase_limit","fees","_g","setupFeeTrialEnabled","_h","setup_fee_trial_enabled","amount","ad_hoc_amount","subtotal_amount","scratchAmount","scratch_amount","currency","_j","trialDurationDays","_k","trial_duration_days","interval","intervalString","showOnce","hasSubscription","onScUpdateQuantity","e","detail","onScRemove","openWormhole"],"sources":["./src/components/controllers/checkout-form/line-items/sc-line-items.css?tag=sc-line-items&encapsulation=shadow","./src/components/controllers/checkout-form/line-items/sc-line-items.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n:slotted(* ~ *) {\n  margin-top: 20px;\n}\n\n.line-items {\n  display: grid;\n  gap: var(--sc-form-row-spacing);\n}\n\n.line-item {\n  display: grid;\n  gap: var(--sc-spacing-small);\n}\n\n.fee__description {\n  opacity: 0.75;\n}\n","import { Component, Event, EventEmitter, h, Prop } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { openWormhole } from 'stencil-wormhole';\n\nimport { hasSubscription } from '../../../../functions/line-items';\nimport { intervalString } from '../../../../functions/price';\nimport { LineItem, LineItemData, Checkout, PriceChoice, Prices, Product } from '../../../../types';\n\n@Component({\n  tag: 'sc-line-items',\n  styleUrl: 'sc-line-items.css',\n  shadow: true,\n})\nexport class ScLineItems {\n  @Prop() order: Checkout;\n  @Prop() busy: boolean;\n  @Prop() prices: Prices;\n  @Prop() editable: boolean;\n  @Prop() removable: boolean;\n  @Prop() editLineItems: boolean = true;\n  @Prop() removeLineItems: boolean = true;\n  @Prop() lockedChoices: Array<PriceChoice> = [];\n\n  /** Update the line item. */\n  @Event() scUpdateLineItem: EventEmitter<LineItemData>;\n\n  /** Remove the line item. */\n  @Event() scRemoveLineItem: EventEmitter<LineItemData>;\n\n  /** Update quantity for this line item. */\n  updateQuantity(item: LineItem, quantity: number) {\n    this.scUpdateLineItem.emit({ price_id: item.price.id, quantity });\n  }\n\n  removeLineItem(item: LineItem) {\n    this.scRemoveLineItem.emit({ price_id: item.price.id, quantity: 1 });\n  }\n\n  /** Only append price name if there's more than one product price in the session. */\n  getName(item: LineItem) {\n    const otherPrices = Object.keys(this.prices || {}).filter(key => {\n      const price = this.prices[key];\n      // @ts-ignore\n      return price.product === item.price.product.id;\n    });\n\n    let name = '';\n    if (otherPrices.length > 1) {\n      name = `${(item?.price?.product as Product)?.name} \\u2013 ${item?.price?.name}`;\n    } else {\n      name = (item?.price?.product as Product)?.name;\n    }\n    return name;\n  }\n\n  // Is this price choice locked?\n  isLocked(item) {\n    return this.lockedChoices.some(choice => choice.id === item.price.id);\n  }\n\n  isEditable(item: LineItem) {\n    // ad hoc prices cannot have quantity.\n    if (item?.price?.ad_hoc) {\n      return false;\n    }\n\n    // if the item has a bump amount, it cannot have quantity.\n    if (item?.bump_amount) {\n      return false;\n    }\n\n    if (this.editable !== null) return this.editable;\n    return this.editLineItems;\n  }\n\n  isRemovable() {\n    if (this.removable !== null) return this.removable;\n    return this.removeLineItems;\n  }\n\n  render() {\n    if (!!this.busy && !this.order?.line_items?.data?.length) {\n      return (\n        <sc-line-item>\n          <sc-skeleton style={{ 'width': '50px', 'height': '50px', '--border-radius': '0' }} slot=\"image\"></sc-skeleton>\n          <sc-skeleton slot=\"title\" style={{ width: '120px', display: 'inline-block' }}></sc-skeleton>\n          <sc-skeleton slot=\"description\" style={{ width: '60px', display: 'inline-block' }}></sc-skeleton>\n          <sc-skeleton style={{ width: '120px', display: 'inline-block' }} slot=\"price\"></sc-skeleton>\n          <sc-skeleton style={{ width: '60px', display: 'inline-block' }} slot=\"price-description\"></sc-skeleton>\n        </sc-line-item>\n      );\n    }\n\n    return (\n      <div class=\"line-items\">\n        {(this.order?.line_items?.data || [])\n          .sort((a, b) => {\n            if (a.price?.id < b.price?.id) return -1;\n            return a.price?.id > b.price?.id ? 1 : 0;\n          })\n          .map(item => {\n            return (\n              <div class=\"line-item\">\n                <sc-product-line-item\n                  key={item.id}\n                  imageUrl={(item?.price?.product as Product)?.image_url}\n                  name={(item?.price?.product as Product)?.name}\n                  max={(item?.price?.product as Product)?.purchase_limit}\n                  editable={this.isEditable(item)}\n                  removable={this.isRemovable()}\n                  quantity={item.quantity}\n                  fees={item?.fees?.data}\n                  setupFeeTrialEnabled={item?.price?.setup_fee_trial_enabled}\n                  amount={item.ad_hoc_amount !== null ? item.ad_hoc_amount : item.subtotal_amount}\n                  scratchAmount={item.ad_hoc_amount == null && item?.scratch_amount}\n                  currency={this.order?.currency}\n                  trialDurationDays={item?.price?.trial_duration_days}\n                  interval={!!item?.price && intervalString(item?.price, { showOnce: hasSubscription(this.order) })}\n                  onScUpdateQuantity={e => this.updateQuantity(item, e.detail)}\n                  onScRemove={() => this.removeLineItem(item)}\n                />\n              </div>\n            );\n          })}\n      </div>\n    );\n  }\n}\n\nopenWormhole(ScLineItems, ['order', 'busy', 'prices', 'lockedChoices', 'editLineItems', 'removeLineItems'], false);\n"],"mappings":"sLAAA,MAAMA,EAAiB,gM,MCaVC,EAAW,M,kQAMW,K,qBACE,K,mBACS,E,CAS5CC,eAAeC,EAAgBC,GAC7BC,KAAKC,iBAAiBC,KAAK,CAAEC,SAAUL,EAAKM,MAAMC,GAAIN,Y,CAGxDO,eAAeR,GACbE,KAAKO,iBAAiBL,KAAK,CAAEC,SAAUL,EAAKM,MAAMC,GAAIN,SAAU,G,CAIlES,QAAQV,G,cACN,MAAMW,EAAcC,OAAOC,KAAKX,KAAKY,QAAU,IAAIC,QAAOC,IACxD,MAAMV,EAAQJ,KAAKY,OAAOE,GAE1B,OAAOV,EAAMW,UAAYjB,EAAKM,MAAMW,QAAQV,EAAE,IAGhD,IAAIW,EAAO,GACX,GAAIP,EAAYQ,OAAS,EAAG,CAC1BD,EAAO,IAAGE,GAACC,EAAArB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAe,SAAA,SAAAA,EAAEJ,WAAmB,MAAAG,SAAA,SAAAA,EAAEF,WAAeI,EAAAtB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAgB,SAAA,SAAAA,EAAEJ,M,KACpE,CACLA,GAAOK,GAACC,EAAAxB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAkB,SAAA,SAAAA,EAAEP,WAAmB,MAAAM,SAAA,SAAAA,EAAEL,I,CAE5C,OAAOA,C,CAITO,SAASzB,GACP,OAAOE,KAAKwB,cAAcC,MAAKC,GAAUA,EAAOrB,KAAOP,EAAKM,MAAMC,I,CAGpEsB,WAAW7B,G,MAET,IAAIqB,EAAArB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAe,SAAA,SAAAA,EAAES,OAAQ,CACvB,OAAO,K,CAIT,GAAI9B,IAAI,MAAJA,SAAI,SAAJA,EAAM+B,YAAa,CACrB,OAAO,K,CAGT,GAAI7B,KAAK8B,WAAa,KAAM,OAAO9B,KAAK8B,SACxC,OAAO9B,KAAK+B,a,CAGdC,cACE,GAAIhC,KAAKiC,YAAc,KAAM,OAAOjC,KAAKiC,UACzC,OAAOjC,KAAKkC,e,CAGdC,S,cACE,KAAMnC,KAAKoC,SAAShB,GAAAF,GAAAC,EAAAnB,KAAKqC,SAAK,MAAAlB,SAAA,SAAAA,EAAEmB,cAAU,MAAApB,SAAA,SAAAA,EAAEqB,QAAI,MAAAnB,SAAA,SAAAA,EAAEH,QAAQ,CACxD,OACEuB,EAAA,oBACEA,EAAA,eAAaC,MAAO,CAAEC,MAAS,OAAQC,OAAU,OAAQ,kBAAmB,KAAOC,KAAK,UACxFJ,EAAA,eAAaI,KAAK,QAAQH,MAAO,CAAEC,MAAO,QAASG,QAAS,kBAC5DL,EAAA,eAAaI,KAAK,cAAcH,MAAO,CAAEC,MAAO,OAAQG,QAAS,kBACjEL,EAAA,eAAaC,MAAO,CAAEC,MAAO,QAASG,QAAS,gBAAkBD,KAAK,UACtEJ,EAAA,eAAaC,MAAO,CAAEC,MAAO,OAAQG,QAAS,gBAAkBD,KAAK,sB,CAK3E,OACEJ,EAAA,OAAKM,MAAM,iBACPzB,GAAAC,EAAAtB,KAAKqC,SAAK,MAAAf,SAAA,SAAAA,EAAEgB,cAAU,MAAAjB,SAAA,SAAAA,EAAEkB,OAAQ,IAC/BQ,MAAK,CAACC,EAAGC,K,YACR,KAAI9B,EAAA6B,EAAE5C,SAAK,MAAAe,SAAA,SAAAA,EAAEd,MAAKa,EAAA+B,EAAE7C,SAAK,MAAAc,SAAA,SAAAA,EAAEb,IAAI,OAAQ,EACvC,QAAOe,EAAA4B,EAAE5C,SAAK,MAAAgB,SAAA,SAAAA,EAAEf,MAAKiB,EAAA2B,EAAE7C,SAAK,MAAAkB,SAAA,SAAAA,EAAEjB,IAAK,EAAI,CAAC,IAEzC6C,KAAIpD,I,wBACH,OACE0C,EAAA,OAAKM,MAAM,aACTN,EAAA,wBACE1B,IAAKhB,EAAKO,GACV8C,UAAUjC,GAACC,EAAArB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAe,SAAA,SAAAA,EAAEJ,WAAmB,MAAAG,SAAA,SAAAA,EAAEkC,UAC7CpC,MAAMM,GAACF,EAAAtB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAgB,SAAA,SAAAA,EAAEL,WAAmB,MAAAO,SAAA,SAAAA,EAAEN,KACzCqC,KAAKC,GAACjC,EAAAvB,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAiB,SAAA,SAAAA,EAAEN,WAAmB,MAAAuC,SAAA,SAAAA,EAAEC,eACxCzB,SAAU9B,KAAK2B,WAAW7B,GAC1BmC,UAAWjC,KAAKgC,cAChBjC,SAAUD,EAAKC,SACfyD,MAAMC,EAAA3D,IAAI,MAAJA,SAAI,SAAJA,EAAM0D,QAAI,MAAAC,SAAA,SAAAA,EAAElB,KAClBmB,sBAAsBC,EAAA7D,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAuD,SAAA,SAAAA,EAAEC,wBACnCC,OAAQ/D,EAAKgE,gBAAkB,KAAOhE,EAAKgE,cAAgBhE,EAAKiE,gBAChEC,cAAelE,EAAKgE,eAAiB,OAAQhE,IAAI,MAAJA,SAAI,SAAJA,EAAMmE,gBACnDC,UAAUC,EAAAnE,KAAKqC,SAAK,MAAA8B,SAAA,SAAAA,EAAED,SACtBE,mBAAmBC,EAAAvE,IAAI,MAAJA,SAAI,SAAJA,EAAMM,SAAK,MAAAiE,SAAA,SAAAA,EAAEC,oBAChCC,YAAYzE,IAAI,MAAJA,SAAI,SAAJA,EAAMM,QAASoE,EAAe1E,IAAI,MAAJA,SAAI,SAAJA,EAAMM,MAAO,CAAEqE,SAAUC,EAAgB1E,KAAKqC,SACxFsC,mBAAoBC,GAAK5E,KAAKH,eAAeC,EAAM8E,EAAEC,QACrDC,WAAY,IAAM9E,KAAKM,eAAeR,KAEpC,I,GAQpBiF,EAAanF,EAAa,CAAC,QAAS,OAAQ,SAAU,gBAAiB,gBAAiB,mBAAoB,O"}